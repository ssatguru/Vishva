var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),org;!function(t){!function(t){!function(t){!function(t){var e=BABYLON.Vector3,i=function(){function t(t,i,s,o,a){var r=this;this.slopeLimit=30,this.sl=Math.PI*this.slopeLimit/180,this.started=!1,this.avatarSpeed=3,this.prevAnim=null,this.jumpCycleMax=25,this.jumpCycle=this.jumpCycleMax,this.wasJumping=!1,this.gravity=9.8,this.oldPos=new e(0,0,0),this.grounded=!1,this.downSpeed=0,this.time=0,this.stillTime=0,this.velocity=new e(0,0,0),this.move=!1,this.avatarSkeleton=i,this.initAnims(s),this.camera=o,this.avatar=t,this.scene=a,this.key=new n,window.addEventListener("keydown",function(t){return r.onKeyDown(t)},!1),window.addEventListener("keyup",function(t){return r.onKeyUp(t)},!1),this.renderer=function(){r.moveAVandCamera()}}return t.prototype.setAvatar=function(t){this.avatar=t},t.prototype.setAvatarSkeleton=function(t){this.avatarSkeleton=t},t.prototype.setAnims=function(t){this.initAnims(t)},t.prototype.setSlopeLimit=function(t){this.slopeLimit=t,this.sl=Math.PI*t/180},t.prototype.start=function(){this.started||(this.started=!0,this.key.reset(),this.time=0,this.stillTime=.001,this.grounded=!1,this.updateTargetValue(),this.scene.registerBeforeRender(this.renderer))},t.prototype.stop=function(){this.started&&(this.started=!1,this.scene.unregisterBeforeRender(this.renderer))},t.prototype.initAnims=function(t){this.walk=t[0],this.walkBack=t[1],this.idle=t[2],this.run=t[3],this.jump=t[4],this.turnLeft=t[5],this.turnRight=t[6],this.strafeLeft=t[7],this.strafeRight=t[8]},t.prototype.moveAVandCamera=function(){if(this.oldPos.copyFrom(this.avatar.position),!this.anyMovement()){if(!this.grounded){if(this.stillTime=this.stillTime+this.scene.getEngine().getDeltaTime()/1e3,this.downSpeed=this.gravity*this.stillTime,this.velocity.copyFromFloats(0,-this.downSpeed,0),this.avatar.moveWithCollisions(this.velocity),this.oldPos.y===this.avatar.position.y)this.grounded=!0,this.stillTime=0;else if(this.avatar.position.y<this.oldPos.y){var t=this.oldPos.subtract(this.avatar.position).length(),i=this.oldPos.y-this.avatar.position.y,s=Math.asin(i/t);s<=this.sl&&(this.grounded=!0,this.stillTime=0,this.avatar.position.copyFrom(this.oldPos))}this.updateTargetValue()}return void(this.prevAnim!=this.idle&&(this.prevAnim=this.idle,this.idle.exist&&this.avatarSkeleton.beginAnimation(this.idle.name,!0,this.idle.r)))}this.stillTime=0,this.grounded=!1;var n=this.scene.getEngine().getDeltaTime()/1e3,o=this.avatarSpeed*n,a=0;this.time=this.time+n,this.downSpeed=this.gravity*this.time;var r,h,l,c,u=this.idle,p=!1,d=this.avatarSpeed*n,g=1;if(this.key.up?(this.key.shift?(a=2*o,u=this.run):(a=o,u=this.walk),this.key.jump&&(this.wasJumping=!0),this.wasJumping?(d*=2,this.jumpCycle<this.jumpCycleMax/2?(g=1,this.jumpCycle<0&&(this.jumpCycle=this.jumpCycleMax,d/=2,this.key.jump=!1,this.wasJumping=!1)):(u=this.jump,g=-1),this.jumpCycle--,r=this.avatar.calcMovePOV(0,-d*g,a)):r=this.avatar.calcMovePOV(0,-this.downSpeed,a),this.avatar.moveWithCollisions(r),p=!0):this.key.down?(h=this.avatar.calcMovePOV(0,-this.downSpeed,-o/2),this.avatar.moveWithCollisions(h),p=!0,u=this.walkBack,this.key.jump&&(this.key.jump=!1)):this.key.stepLeft?(u=this.strafeLeft,l=this.avatar.calcMovePOV(-o/2,-this.downSpeed,0),this.avatar.moveWithCollisions(l),p=!0):this.key.stepRight&&(u=this.strafeRight,c=this.avatar.calcMovePOV(o/2,-this.downSpeed,0),this.avatar.moveWithCollisions(c),p=!0),p||(this.key.jump&&(this.wasJumping=!0),this.wasJumping?(d*=2,this.jumpCycle<this.jumpCycleMax/2?(g=1,this.jumpCycle<0&&(this.jumpCycle=this.jumpCycleMax,d/=2,this.key.jump=!1,this.wasJumping=!1)):(u=this.jump,g=-1),this.jumpCycle--):g/=2,this.avatar.moveWithCollisions(new e(0,-d*g,0))),this.key.stepLeft||this.key.stepRight||(this.key.left?(this.camera.alpha=this.camera.alpha+.022,p||(this.avatar.rotation.y=-4.69-this.camera.alpha,u=this.turnLeft)):this.key.right&&(this.camera.alpha=this.camera.alpha-.022,p||(this.avatar.rotation.y=-4.69-this.camera.alpha,u=this.turnRight))),p&&(this.avatar.rotation.y=-4.69-this.camera.alpha),this.avatar.position.y<this.oldPos.y){var t=this.oldPos.subtract(this.avatar.position).length(),i=this.oldPos.y-this.avatar.position.y,s=Math.asin(i/t);s<=this.sl&&(this.time=0)}this.prevAnim!==u&&(u.exist&&this.avatarSkeleton.beginAnimation(u.name,!0,u.r),this.prevAnim=u),this.updateTargetValue(),this.oldPos.y<=this.avatar.position.y&&(this.time=0)},t.prototype.updateTargetValue=function(){this.camera.target.copyFromFloats(this.avatar.position.x,this.avatar.position.y+1.5,this.avatar.position.z)},t.prototype.onKeyDown=function(t){var e=t,i=String.fromCharCode(e.keyCode);32===e.keyCode?this.key.jump=!1:16===e.keyCode?this.key.shift=!0:"W"===i||38===e.keyCode?this.key.up=!0:"A"===i||37===e.keyCode?this.key.left=!0:"D"===i||39===e.keyCode?this.key.right=!0:"S"===i||40===e.keyCode?this.key.down=!0:"Q"===i?this.key.stepLeft=!0:"E"===i&&(this.key.stepRight=!0),this.move=this.anyMovement()},t.prototype.anyMovement=function(){return!!(this.key.up||this.key.down||this.key.left||this.key.right||this.key.stepLeft||this.key.stepRight||this.key.jump)},t.prototype.onKeyUp=function(t){var e=t,i=String.fromCharCode(e.keyCode);32===e.keyCode?this.key.jump=!0:16===e.keyCode?this.key.shift=!1:"W"===i||38===e.keyCode?this.key.up=!1:"A"===i||37===e.keyCode?this.key.left=!1:"D"===i||39===e.keyCode?this.key.right=!1:"S"===i||40===e.keyCode?this.key.down=!1:"Q"===i?this.key.stepLeft=!1:"E"===i&&(this.key.stepRight=!1),this.move=this.anyMovement()},t}();t.CharacterControl=i;var s=function(){function t(t,e,i,s){this.exist=!1,this.s=0,this.e=0,this.r=0,this.name=t,this.s=e,this.e=i,this.r=s}return t}();t.AnimData=s;var n=function(){function t(){this.up=!1,this.down=!1,this.right=!1,this.left=!1,this.stepRight=!1,this.stepLeft=!1,this.jump=!1,this.shift=!1}return t.prototype.reset=function(){this.up=!1,this.down=!1,this.right=!1,this.left=!1,this.stepRight=!1,this.stepLeft=!1,this.jump=!1,this.shift=!1},t}();t.Key=n}(t.component||(t.component={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=function(){function t(t,e,i,s,n){var o=this;this.inner1="<input class='colorInput' type='text' style='width:100%;height:32px;border-width:1px;border-style:solid;cursor: pointer' readonly></input>",this.inner2="<div class='colorDiag' style='align-content: center'><div  class='colorPicker cp-fancy'></div></div>",this.hexColor=i;var a=document.getElementById(e);a.innerHTML=this.inner1.concat(this.inner2),this.colorInput=a.getElementsByClassName("colorInput")[0],this.colorInput.style.backgroundColor=this.hexColor,this.colorInput.value=this.hexColor,this.colorInput.onclick=function(){o.diag.dialog("open"),o.cp.setHex(o.hexColor)};var r=a.getElementsByClassName("colorDiag")[0],h=r.getElementsByClassName("colorPicker")[0];this.cp=new ColorPicker(h,function(t,e,i){o.hexColor=t,o.colorInput.style.backgroundColor=t,o.colorInput.value=t,n(t,e,i)});var l={autoOpen:!1,resizable:!1,position:s,height:"auto",closeText:"",closeOnEscape:!1,title:t};this.diag=$(r),this.diag.dialog(l),this.diag.jpo=s}return t.prototype.open=function(t){this.diag.dialog("open"),this.setColor(t)},t.prototype.setColor=function(t){this.hexColor=t,this.cp.setHex(t),this.colorInput.style.backgroundColor=t,this.colorInput.value=t},t.prototype.getColor=function(){return this.hexColor},t}();t.ColorPickerDiag=e;!function(){function t(){this.r=0,this.g=0,this.b=0}}()}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(e){!function(e){!function(e){!function(i){var s=t.ssatguru.babylonjs.vishva.gui.ColorPickerDiag,n=function(){function t(t){var e=this;this.local=!0,this.menuBarOn=!0,this.STATE_IND="state",this.dialogs=new Array,this.enableToolTips=!0,this.propsDiag=null,this.fixingDragIssue=!1,this.activePanel=-1,this.animSelect=null,this.firstTime=!0,this.addMenuOn=!1,this.vishva=t,this.setSettings(),$(document).tooltip({open:function(t,i){e.enableToolTips||i.tooltip.stop().remove()}}),$("input").on("focus",function(){e.vishva.disableKeys()}),$("input").on("blur",function(){e.vishva.enableKeys()}),this.createJPOs(),this.createAddMenu(),this.createNavMenu(),this.createDownloadDiag(),this.createHelpDiag(),this.createAlertDiag(),this.create_sNaDiag(),this.createEditSensDiag(),this.createEditActDiag(),window.addEventListener("resize",function(t){return e.onWindowResize(t)})}return t.prototype.createJPOs=function(){this.centerBottom={at:"center bottom",my:"center bottom",of:window},this.leftCenter={at:"left center",my:"left center",of:window},this.rightCenter={at:"right center",my:"right center",of:window}},t.prototype.onWindowResize=function(t){for(var e=0;e<this.dialogs.length;e++){var i=this.dialogs[e],s=i.jpo;if(null!=s){i.dialog("option","position",s);i.dialog("isOpen")&&(i.dialog("close"),i.dialog("open"))}}},t.prototype.createAddMenu=function(){var t=this,e=Object.keys(this.vishva.assets),i=document.getElementById("AddMenu");i.style.visibility="visible";for(var s=function(e){return t.onAddMenuItemClick(e)},n=0,o=e;n<o.length;n++){var a=o[n];if("sounds"!==a){var r=document.createElement("li");r.id="add-"+a,r.innerText=a,r.onclick=s,i.appendChild(r)}}},t.prototype.onAddMenuItemClick=function(t){var e=t.target,i=e.diag;if(null==i){var s=e.innerHTML;i=this.createAssetDiag(s),e.diag=i}return i.dialog("open"),!0},t.prototype.createAssetDiag=function(t){var e=document.createElement("div");e.id=t+"Div",e.setAttribute("title",t);var i=document.createElement("table");i.id=t+"Tbl";var s=this.vishva.assets[t];this.updateAssetTable(i,t,s),e.appendChild(i),document.body.appendChild(e);var n=$("#"+e.id),o={autoOpen:!1,resizable:!0,position:this.centerBottom,width:"100%",height:"auto",closeText:"",closeOnEscape:!1};return n.dialog(o),n.jpo=this.centerBottom,this.dialogs.push(n),n},t.prototype.updateAssetTable=function(e,i,s){var n=this;if(!(e.rows.length>0)){for(var o=function(t){return n.onAssetImgClick(t)},a=e.insertRow(),r=0;r<s.length;r++){var h=s[r],l=document.createElement("img");l.id=h,l.src="vishva/assets/"+i+"/"+h+"/"+h+".jpg",l.setAttribute("style",t.SMALL_ICON_SIZE+"cursor:pointer;"),l.className=i,l.onclick=o;var c=a.insertCell();c.appendChild(l)}for(var u=e.insertRow(),p=0;p<s.length;p++){var h=s[p],c=u.insertCell();c.innerText=h}}},t.prototype.onAssetImgClick=function(t){var e=t.target;return"skyboxes"===e.className?this.vishva.setSky(e.id):"primitives"===e.className?this.vishva.addPrim(e.id):"water"===e.className?this.vishva.createWater():this.vishva.loadAsset(e.className,e.id),!0},t.prototype.createEnvDiag=function(){var t=this,e=$("#sunPos"),i=$("#light"),n=$("#shade"),o=$("#fog"),a=$("#fov");e.slider(this.sliderOptions(0,180,this.vishva.getSunPos())),i.slider(this.sliderOptions(0,100,100*this.vishva.getLight())),n.slider(this.sliderOptions(0,100,100*this.vishva.getShade())),o.slider(this.sliderOptions(0,100,1e5*this.vishva.getFog()));new s("fog color","fogCol",this.vishva.getFogColor(),this.centerBottom,function(e,i,s){t.vishva.setFogColor(e)});a.slider(this.sliderOptions(0,180,this.vishva.getFov())),document.getElementById("envSnow").onclick=function(e){t.vishva.toggleSnow()},document.getElementById("envRain").onclick=function(e){t.vishva.toggleRain()},document.getElementById("skyButton").onclick=function(t){return document.getElementById("add-skyboxes").click(),!0},document.getElementById("trnButton").onclick=function(e){return t.showAlertDiag("Sorry. To be implemneted soon"),!0};new s("terrain color","trnCol",this.vishva.getGroundColor(),this.centerBottom,function(e,i,s){t.vishva.setGroundColor(e)});this.envDiag=$("#envDiv");var r={autoOpen:!1,resizable:!1,position:this.rightCenter,minWidth:350,height:"auto",closeText:"",closeOnEscape:!1};this.envDiag.dialog(r),this.envDiag.jpo=this.rightCenter,this.dialogs.push(this.envDiag)},t.prototype.createSettingDiag=function(){var t=this;this.settingDiag=$("#settingDiag"),this.camCol=$("#camCol"),this.autoEditMenu=$("#autoEditMenu"),this.showToolTips=$("#showToolTips"),this.showInvis=$("#showInvis"),this.showDisa=$("#showDisa"),this.snapper=$("#snapper");var e={autoOpen:!1,resizable:!1,position:this.rightCenter,minWidth:350,height:"auto",closeText:"",closeOnEscape:!1};this.settingDiag.dialog(e),this.settingDiag.jpo=this.rightCenter,this.dialogs.push(this.settingDiag);var i={};i.text="save",i.click=function(e){t.vishva.enableCameraCollision(t.camCol.prop("checked")),t.vishva.enableAutoEditMenu(t.autoEditMenu.prop("checked")),t.enableToolTips=t.showToolTips.prop("checked"),t.showInvis.prop("checked")?t.vishva.showAllInvisibles():t.vishva.hideAllInvisibles(),t.showDisa.prop("checked")?t.vishva.showAllDisabled():t.vishva.hideAllDisabled();var i=t.vishva.snapper(t.snapper.prop("checked"));return null!=i?(t.showAlertDiag(i),!1):(t.settingDiag.dialog("close"),t.refreshPropsDiag(),!0)};var s={};s.text="Cancel",s.click=function(e){return t.settingDiag.dialog("close"),!0};var n=[i,s];this.settingDiag.dialog("option","buttons",n)},t.prototype.updateSettings=function(){this.camCol.prop("checked",this.vishva.isCameraCollisionOn()),this.autoEditMenu.prop("checked",this.vishva.isAutoEditMenuOn()),this.showToolTips.prop("checked",this.enableToolTips)},t.prototype.createDownloadDiag=function(){this.downloadLink=document.getElementById("downloadLink"),this.downloadDialog=$("#saveDiv"),this.downloadDialog.dialog(),this.downloadDialog.dialog("close")},t.prototype.createUploadDiag=function(){var t=this,e=document.getElementById("loadFileInput");document.getElementById("loadFileOk").onclick=function(e){return function(i){var s=e.files;if(0===s.length)return alert("no file slected"),null;for(var n=null,o=0;o<s.length;o++)n=s[o];return t.vishva.loadAssetFile(n),t.loadDialog.dialog("close"),!0}}(e),this.loadDialog=$("#loadDiv"),this.loadDialog.dialog(),this.loadDialog.dialog("close")},t.prototype.createHelpDiag=function(){this.helpDiag=$("#helpDiv");var t={autoOpen:!1,resizable:!1,width:500,closeOnEscape:!1,closeText:""};this.helpDiag.dialog(t)},t.prototype.create_sNaDiag=function(){var t=this;$("#sNaDetails").tabs(),this.sNaDialog=$("#sNaDiag");var e={};e.autoOpen=!1,e.modal=!1,e.resizable=!1,e.width="auto",e.height="auto",e.title="Sensors and Actuators",e.closeOnEscape=!1,e.closeText="",e.close=function(e,i){t.vishva.switchDisabled=!1},e.dragStop=function(e,i){t.sNaDialog.dialog("close"),t.sNaDialog.dialog("open")},this.sNaDialog.dialog(e),this.sensSel=document.getElementById("sensSel"),this.actSel=document.getElementById("actSel");for(var i=this.vishva.getSensorList(),s=this.vishva.getActuatorList(),n=0,o=i;n<o.length;n++){var a=o[n],r=document.createElement("option");r.value=a,r.innerHTML=a,this.sensSel.add(r)}for(var h=0,l=s;h<l.length;h++){var c=l[h],r=document.createElement("option");r.value=c,r.innerHTML=c,this.actSel.add(r)}this.sensTbl=document.getElementById("sensTbl"),this.actTbl=document.getElementById("actTbl")},t.prototype.show_sNaDiag=function(){var t=this,e=this.vishva.getSensors();if(null==e)return void this.showAlertDiag("no mesh selected");var i=this.vishva.getActuators();if(null==i)return void this.showAlertDiag("no mesh selected");this.vishva.switchDisabled=!0,this.updateSensActTbl(e,this.sensTbl),this.updateSensActTbl(i,this.actTbl),document.getElementById("addSens").onclick=function(e){var i=t.sensSel.item(t.sensSel.selectedIndex),s=i.value;return t.vishva.addSensorbyName(s),t.updateSensActTbl(t.vishva.getSensors(),t.sensTbl),t.sNaDialog.dialog("close"),t.sNaDialog.dialog("open"),!0},document.getElementById("addAct").onclick=function(e){var i=t.actSel.item(t.actSel.selectedIndex),s=i.value;return t.vishva.addActuaorByName(s),t.updateSensActTbl(t.vishva.getActuators(),t.actTbl),t.sNaDialog.dialog("close"),t.sNaDialog.dialog("open"),!0},this.sNaDialog.dialog("open")},t.prototype.updateSensActTbl=function(t,e){for(var i=this,s=e.rows.length,n=s-1;n>0;n--)e.deleteRow(n);s=t.length;for(var n=0;n<s;n++){var o=e.insertRow(),a=o.insertCell();a.innerHTML=t[n].getName(),a=o.insertCell(),a.innerHTML=t[n].getProperties().signalId,a=o.insertCell();var r=document.createElement("BUTTON");r.innerHTML="edit";$(r).button();var h=n;r.id=h.toString(),r.sa=t[n],a.appendChild(r),r.onclick=function(t){var e=t.currentTarget,s=e.sa;return"SENSOR"===s.getType()?i.showEditSensDiag(s):i.showEditActDiag(s),!0},a=o.insertCell();var l=document.createElement("BUTTON");l.innerHTML="del";$(l).button(),l.id=h.toString(),l.row=o,l.sa=t[n],a.appendChild(l),l.onclick=function(t){var s=t.currentTarget,n=s.row;return e.deleteRow(n.rowIndex),i.vishva.removeSensorActuator(s.sa),!0}}},t.prototype.createEditSensDiag=function(){var t=$("#editSensDiag"),e={};e.autoOpen=!1,e.modal=!0,e.resizable=!1,e.width="auto",e.title="Edit Sensor",e.closeText="",e.closeOnEscape=!1,t.dialog(e)},t.prototype.showEditSensDiag=function(t){var e=this;this.vishva.disableKeys(),document.getElementById("editSensDiag.sensName").innerHTML=t.getName();var i=$("#editSensDiag");i.dialog("open");var s=document.getElementById("editSensDiag.parms"),n=s.firstChild;null!=n&&s.removeChild(n),console.log(t.getProperties());var o=this.formCreate(t.getProperties(),s.id);s.appendChild(o);var a={};a.text="save",a.click=function(n){return e.formRead(t.getProperties(),s.id),t.processUpdateGeneric(),e.updateSensActTbl(e.vishva.getSensors(),e.sensTbl),i.dialog("close"),e.vishva.enableKeys(),!0};var r=[a];i.dialog("option","buttons",r)},t.prototype.createEditActDiag=function(){var t=$("#editActDiag"),e={};e.autoOpen=!1,e.modal=!0,e.resizable=!1,e.width="auto",e.title="Edit Actuator",e.closeText="",e.closeOnEscape=!1,t.dialog(e)},t.prototype.showEditActDiag=function(t){var e=this;this.vishva.disableKeys(),document.getElementById("editActDiag.actName").innerHTML=t.getName();var i=$("#editActDiag");i.dialog("open");var s=document.getElementById("editActDiag.parms"),n=s.firstChild;if(null!=n&&s.removeChild(n),"Sound"===t.getName()){t.getProperties().soundFile.values=this.vishva.getSoundFiles()}var o=this.formCreate(t.getProperties(),s.id);s.appendChild(o);var a={};a.text="save",a.click=function(n){return e.formRead(t.getProperties(),s.id),t.processUpdateGeneric(),e.updateSensActTbl(e.vishva.getActuators(),e.actTbl),i.dialog("close"),e.vishva.enableKeys(),!0};var r=[a];i.dialog("option","buttons",r)},t.prototype.formCreate=function(t,e){e+=".";for(var i=document.createElement("table"),s=Object.keys(t),n=0;n<s.length;n++){var o=s[n];if(o.split("_")[0]!==this.STATE_IND){var a=i.insertRow(),r=a.insertCell();r.innerHTML=o,r=a.insertCell();var h=typeof t[o];if("object"===h&&"SelectType"===t[o].type){var l=t[o],c=l.values,u=document.createElement("select");u.id=e+o;for(var p=0;p<c.length;p++){var d=c[p],g=document.createElement("option");d===l.value&&(g.selected=!0),g.innerText=d,u.add(g)}r.appendChild(u)}else{var m=document.createElement("input");if(m.id=e+o,m.className="ui-widget-content ui-corner-all",m.value=t[o],"object"===h&&"Range"===t[o].type){var v=t[o];m.type="range",m.max=new Number(v.max).toString(),m.min=new Number(v.min).toString(),m.step=new Number(v.step).toString(),m.value=new Number(v.value).toString()}else if("string"===h||"number"===h)m.type="text",m.value=t[o];else if("boolean"===h){var f=t[o];m.type="checkbox",f&&m.setAttribute("checked","true")}r.appendChild(m)}}}return i},t.prototype.formRead=function(t,e){e+=".";for(var i=Object.keys(t),s=0;s<i.length;s++){var n=i[s];if(n.split("_")[0]!==this.STATE_IND){var o=typeof t[n];if("object"===o&&"SelectType"===t[n].type){var a=t[n],r=document.getElementById(e+n);a.value=r.value}else{var h=document.getElementById(e+n);if("object"===o&&"Range"===t[n].type){t[n].value=parseFloat(h.value)}else if("string"===o||"number"===o)if("number"===o){var l=parseFloat(h.value);isNaN(l)?t[n]=0:t[n]=l}else t[n]=h.value;else"boolean"===o&&(t[n]=h.checked)}}}},t.prototype.showPropDiag=function(){return!(null==this.propsDiag||!this.propsDiag.dialog("isOpen"))||(this.vishva.anyMeshSelected()?(null==this.propsDiag&&this.createPropsDiag(),this.propsDiag.dialog("open"),!0):void this.showAlertDiag("no mesh selected"))},t.prototype.closePropDiag=function(){this.propsDiag.dialog("close")},t.prototype.createPropsDiag=function(){var t=this,e=$("#propsAcc");e.accordion({animate:100,heightStyle:"content",collapsible:!0,beforeActivate:function(e,i){t.vishva.switchDisabled=!1,t.refreshPanel(t.getPanelIndex(i.newHeader))}}),this.propsDiag=$("#propsDiag");var i={autoOpen:!1,resizable:!1,position:this.leftCenter,minWidth:420,width:420,height:650,closeOnEscape:!1,open:function(i,s){t.fixingDragIssue?t.fixingDragIssue=!1:(t.activePanel=e.accordion("option","active"),t.refreshPanel(t.activePanel))},closeText:"",close:function(e,i){t.vishva.switchDisabled=!1},dragStop:function(e,i){t.fixingDragIssue=!0,t.propsDiag.dialog("close"),t.propsDiag.dialog("open")}};this.propsDiag.dialog(i),this.propsDiag.jpo=this.leftCenter,this.dialogs.push(this.propsDiag)},t.prototype.closePropsDiag=function(){void 0!==this.propsDiag&&null!==this.propsDiag&&this.propsDiag.dialog("close")},t.prototype.refreshPropsDiag=function(){void 0!==this.propsDiag&&null!==this.propsDiag&&!0===this.propsDiag.dialog("isOpen")&&(this.propsDiag.dialog("close"),this.propsDiag.dialog("open"))},t.prototype.refreshGeneralPanel=function(){0===this.activePanel&&this.refreshPropsDiag()},t.prototype.getPanelIndex=function(t){return"General"==t.text()?0:"Physics"==t.text()?1:"Material"==t.text()?2:"Lights"==t.text()?3:"Animations"==t.text()?4:void 0},t.prototype.refreshPanel=function(t){0===t?this.updateGeneral():3===t?this.updateLight():4===t?this.updateAnimations():1===t?this.updatePhysics():2===t&&this.updateMat()},t.prototype.initAnimUI=function(){var t=this,e=document.getElementById("animSkelView"),i=document.getElementById("animRest"),s=document.getElementById("animRangeName"),n=document.getElementById("animRangeStart"),o=document.getElementById("animRangeEnd"),a=document.getElementById("animRangeMake");e.onclick=function(e){t.vishva.toggleSkelView()},i.onclick=function(e){t.vishva.animRest()},a.onclick=function(e){var i=s.value,a=parseInt(n.value);isNaN(a)&&t.showAlertDiag("from frame is not a number");var r=parseInt(o.value);isNaN(r)&&t.showAlertDiag("to frame is not a number"),t.vishva.createAnimRange(i,a,r),t.refreshAnimSelect()},this.animSelect=document.getElementById("animList"),this.animSelect.onchange=function(e){var i=t.animSelect.value;if(null!=i){var s=t.skel.getAnimationRange(i);document.getElementById("animFrom").innerText=new Number(s.from).toString(),document.getElementById("animTo").innerText=new Number(s.to).toString()}return!0},this.animRate=document.getElementById("animRate"),this.animLoop=document.getElementById("animLoop"),document.getElementById("playAnim").onclick=function(e){if(null==t.skel)return!0;var i=t.animSelect.value,s=t.animRate.value;return null!=i&&t.vishva.playAnimation(i,s,t.animLoop.checked),!0},document.getElementById("stopAnim").onclick=function(e){return null==t.skel||(t.vishva.stopAnimation(),!0)}},t.prototype.createAnimDiag=function(){var t=this;this.initAnimUI(),this.meshAnimDiag=$("#meshAnimDiag");var e={};e.autoOpen=!1,e.modal=!1,e.resizable=!1,e.width="auto",e.height="auto",e.closeOnEscape=!1,e.closeText="",e.close=function(e,i){t.vishva.switchDisabled=!1},this.meshAnimDiag.dialog(e)},t.prototype.updateAnimations=function(){this.vishva.switchDisabled=!0,this.initAnimUI(),this.skel=this.vishva.getSkeleton();var t;if(null==this.skel)return void(document.getElementById("skelName").innerText="no skeleton");t=this.skel.name,""===t.trim()&&(t="no name"),document.getElementById("skelName").innerText=t,this.refreshAnimSelect()},t.prototype.refreshAnimSelect=function(){for(var t=this.animSelect.children,e=0|t.length,i=e-1;i>=0;i--)t[i].remove();var s=this.vishva.getAnimationRanges();if(null!==s){for(var n,o=0,a=s;o<a.length;o++){var r=a[o];n=document.createElement("option"),n.value=r.name,n.innerText=r.name,this.animSelect.appendChild(n)}null!=s[0]&&(document.getElementById("animFrom").innerText=new Number(s[0].from).toString(),document.getElementById("animTo").innerText=new Number(s[0].to).toString())}},t.prototype.toString=function(t){return new Number(t).toFixed(2).toString()},t.prototype.initGeneral=function(){var t=this;this.genName=document.getElementById("genName"),this.genName.onchange=function(){t.vishva.setName(t.genName.value)},this.genSpace=document.getElementById("genSpace"),this.genSpace.onchange=function(){var e=t.vishva.setSpace(t.genSpace.value);null!==e&&(t.showAlertDiag(e),t.genSpace.value=t.vishva.getSpace())},void 0===this.transRefresh&&(this.transRefresh=document.getElementById("transRefresh"),this.transRefresh.onclick=function(){return t.updateTransform(),!1}),void 0===this.transBake&&(this.transBake=document.getElementById("transBake"),this.transBake.onclick=function(){return t.vishva.bakeTransforms(),t.updateTransform(),!1}),this.genOperTrans=document.getElementById("operTrans"),this.genOperRot=document.getElementById("operRot"),this.genOperScale=document.getElementById("operScale"),this.genOperFocus=document.getElementById("operFocus"),this.genOperTrans.onclick=function(){t.vishva.setTransOn()},this.genOperRot.onclick=function(){t.vishva.setRotOn()},this.genOperScale.onclick=function(){t.vishva.setScaleOn(),t.vishva.isSpaceLocal()||t.showAlertDiag("note that scaling doesnot work with global axis")},this.genOperFocus.onclick=function(){t.vishva.setFocusOnMesh()},this.genSnapTrans=document.getElementById("snapTrans"),this.genSnapTrans.onchange=function(){var e=t.vishva.snapTrans(t.genSnapTrans.checked);null!=e&&(t.showAlertDiag(e),t.genSnapTrans.checked=!1)},this.genSnapRot=document.getElementById("snapRot"),this.genSnapRot.onchange=function(){var e=t.vishva.snapRot(t.genSnapRot.checked);null!=e&&(t.showAlertDiag(e),t.genSnapRot.checked=!1)},this.genSnapScale=document.getElementById("snapScale"),this.genSnapScale.onchange=function(){var e=t.vishva.snapScale(t.genSnapScale.checked);null!=e&&(t.showAlertDiag(e),t.genSnapScale.checked=!1)},this.genSnapTransValue=document.getElementById("snapTransValue"),this.genSnapTransValue.onchange=function(){t.vishva.setSnapTransValue(Number(t.genSnapTransValue.value))},this.genSnapRotValue=document.getElementById("snapRotValue"),this.genSnapRotValue.onchange=function(){t.vishva.setSnapRotValue(Number(t.genSnapRotValue.value))},this.genSnapScaleValue=document.getElementById("snapScaleValue"),this.genSnapScaleValue.onchange=function(){t.vishva.setSnapScaleValue(Number(t.genSnapScaleValue.value))},this.genDisable=document.getElementById("genDisable"),this.genDisable.onchange=function(){t.vishva.disableIt(t.genDisable.checked)},this.genColl=document.getElementById("genColl"),this.genColl.onchange=function(){t.vishva.enableCollision(t.genColl.checked)},this.genVisi=document.getElementById("genVisi"),this.genVisi.onchange=function(){t.vishva.makeVisibile(t.genVisi.checked)};var e=document.getElementById("undo"),i=document.getElementById("redo"),s=document.getElementById("parentMesh"),n=document.getElementById("removeParent"),o=document.getElementById("removeChildren"),a=document.getElementById("cloneMesh"),r=document.getElementById("instMesh"),h=document.getElementById("mergeMesh"),l=document.getElementById("subMesh"),c=document.getElementById("interMesh"),u=document.getElementById("downMesh"),p=document.getElementById("delMesh"),d=document.getElementById("swAv"),g=document.getElementById("swGnd"),m=document.getElementById("sNa");e.onclick=function(e){return t.vishva.undo(),!1},i.onclick=function(e){return t.vishva.redo(),!1},s.onclick=function(e){var i=t.vishva.makeParent();return null!=i&&t.showAlertDiag(i),!1},n.onclick=function(e){var i=t.vishva.removeParent();return null!=i&&t.showAlertDiag(i),!1},o.onclick=function(e){var i=t.vishva.removeChildren();return null!=i&&t.showAlertDiag(i),!1},a.onclick=function(e){var i=t.vishva.clone_mesh();return null!=i&&t.showAlertDiag(i),!1},r.onclick=function(e){var i=t.vishva.instance_mesh();return null!=i&&t.showAlertDiag(i),!1},h.onclick=function(e){var i=t.vishva.mergeMeshes();return null!=i&&t.showAlertDiag(i),!1},l.onclick=function(e){var i=t.vishva.csgOperation("subtract");return null!=i&&t.showAlertDiag(i),!1},c.onclick=function(e){var i=t.vishva.csgOperation("intersect");return null!=i&&t.showAlertDiag(i),!1},u.onclick=function(e){var i=t.vishva.saveAsset();return null==i?(t.showAlertDiag("No Mesh Selected"),!0):(t.downloadLink.href=i,$("#saveDiv").dialog("open"),!1)},p.onclick=function(e){var i=t.vishva.delete_mesh();return null!=i&&t.showAlertDiag(i),!1},d.onclick=function(e){var i=t.vishva.switchAvatar();return null!=i&&t.showAlertDiag(i),!0},g.onclick=function(e){var i=t.vishva.switchGround();return null!=i&&t.showAlertDiag(i),!0},m.onclick=function(e){return t.show_sNaDiag(),!0}},t.prototype.updateGeneral=function(){void 0===this.genName&&this.initGeneral(),this.genName.value=this.vishva.getName(),this.genSpace.value=this.vishva.getSpace(),this.updateTransform(),this.genDisable.checked=this.vishva.isDisabled(),this.genColl.checked=this.vishva.isCollideable(),this.genVisi.checked=this.vishva.isVisible()},t.prototype.updateTransform=function(){var t=this.vishva.getLocation(),e=this.vishva.getRotation(),i=this.vishva.getScale();document.getElementById("loc.x").value=this.toString(t.x),document.getElementById("loc.y").value=this.toString(t.y),document.getElementById("loc.z").value=this.toString(t.z),document.getElementById("rot.x").value=this.toString(e.x),document.getElementById("rot.y").value=this.toString(e.y),document.getElementById("rot.z").value=this.toString(e.z),document.getElementById("scl.x").value=this.toString(i.x),document.getElementById("scl.y").value=this.toString(i.y),document.getElementById("scl.z").value=this.toString(i.z)},t.prototype.initLightUI=function(){var t=this;this.lightAtt=document.getElementById("lightAtt"),this.lightType=document.getElementById("lightType"),this.lightDiff=new s("diffuse light","lightDiff","#ffffff",this.centerBottom,function(e,i,s){t.applyLight()}),this.lightSpec=new s("specular light","lightSpec","#ffffff",this.centerBottom,function(e,i,s){t.applyLight()}),this.lightInten=document.getElementById("lightInten"),this.lightRange=document.getElementById("lightRange"),this.lightRadius=document.getElementById("lightAtt"),this.lightAngle=document.getElementById("lightAngle"),this.lightExp=document.getElementById("lightExp"),this.lightGndClr=document.getElementById("lightGndClr"),this.lightDirX=document.getElementById("lightDirX"),this.lightDirY=document.getElementById("lightDirY"),this.lightDirZ=document.getElementById("lightDirZ"),this.lightAtt.onchange=function(){t.lightAtt.checked?t.applyLight():t.vishva.detachLight()},this.lightType.onchange=function(){return t.applyLight()},this.lightInten.onchange=function(){return t.applyLight()},this.lightRange.onchange=function(){return t.applyLight()},this.lightAngle.onchange=function(){return t.applyLight()},this.lightExp.onchange=function(){return t.applyLight()},this.lightDirX.onchange=function(){return t.applyLight()},this.lightDirY.onchange=function(){return t.applyLight()},this.lightDirZ.onchange=function(){return t.applyLight()}},t.prototype.updateLight=function(){void 0===this.lightAtt&&this.initLightUI();var t=this.vishva.getAttachedLight();null===t?(this.lightAtt.checked=!1,t=new e.LightParm):this.lightAtt.checked=!0,this.lightType.value=t.type,this.lightDiff.setColor(t.diffuse.toHexString()),this.lightSpec.setColor(t.specular.toHexString()),this.lightInten.value=Number(t.intensity).toString(),
this.lightRange.value=Number(t.range).toString(),this.lightRadius.value=Number(t.radius).toString(),this.lightAngle.value=Number(t.angle).toString(),this.lightExp.value=Number(t.exponent).toString(),this.lightGndClr.value=t.gndClr.toHexString(),this.lightDirX.value=Number(t.direction.x).toString(),this.lightDirY.value=Number(t.direction.y).toString(),this.lightDirZ.value=Number(t.direction.z).toString()},t.prototype.applyLight=function(){if(this.lightAtt.checked){var t=new e.LightParm;t.type=this.lightType.value,t.diffuse=BABYLON.Color3.FromHexString(this.lightDiff.getColor()),t.specular=BABYLON.Color3.FromHexString(this.lightSpec.getColor()),t.intensity=parseFloat(this.lightInten.value),t.range=parseFloat(this.lightRange.value),t.radius=parseFloat(this.lightRadius.value),t.angle=parseFloat(this.lightAngle.value),t.direction.x=parseFloat(this.lightDirX.value),t.direction.y=parseFloat(this.lightDirY.value),t.direction.z=parseFloat(this.lightDirZ.value),t.exponent=parseFloat(this.lightExp.value),t.gndClr=BABYLON.Color3.FromHexString(this.lightGndClr.value),this.vishva.attachAlight(t)}},t.prototype.initMatUI=function(){var t=this;this.matVisVal=document.getElementById("matVisVal"),this.matVis=document.getElementById("matVis"),this.matColType=document.getElementById("matColType"),this.matColType.onchange=function(){var e=t.vishva.getMeshColor(t.matColType.value);t.matColDiag.setColor(e)},this.matColDiag=new s("mesh color","matCol",this.vishva.getMeshColor(this.matColType.value),this.centerBottom,function(e,i,s){var n=t.vishva.setMeshColor(t.matColType.value,e);null!==n&&t.showAlertDiag(n)}),this.matVisVal.value="1.00",this.matVis.oninput=function(){t.matVisVal.value=Number(t.matVis.value).toFixed(2),t.vishva.setMeshVisibility(parseFloat(t.matVis.value))}},t.prototype.updateMat=function(){void 0==this.matVis&&this.initMatUI(),this.matVis.value=Number(this.vishva.getMeshVisibility()).toString(),this.matVisVal.value=Number(this.matVis.value).toFixed(2),this.matColDiag.setColor(this.vishva.getMeshColor(this.matColType.value))},t.prototype.initPhyUI=function(){var t=this;this.phyEna=document.getElementById("phyEna"),this.phyType=document.getElementById("phyType"),this.phyMass=document.getElementById("phyMass"),this.phyRes=document.getElementById("phyRes"),this.phyResVal=document.getElementById("phyResVal"),this.phyResVal.value="0.0",this.phyRes.oninput=function(){t.phyResVal.value=t.formatValue(t.phyRes.value)},this.phyFric=document.getElementById("phyFric"),this.phyFricVal=document.getElementById("phyFricVal"),this.phyFricVal.value="0.0",this.phyFric.oninput=function(){t.phyFricVal.value=t.formatValue(t.phyFric.value)};var e=document.getElementById("phyApply"),i=document.getElementById("phyTest"),s=document.getElementById("phyReset");e.onclick=function(e){return t.applyPhysics(),t.showAlertDiag("physics applied"),!1},i.onclick=function(e){return t.testPhysics(),!1},s.onclick=function(e){return t.resetPhysics(),!1}},t.prototype.formatValue=function(t){return"1"===t?"1.0":"0"===t?"0.0":t},t.prototype.updatePhysics=function(){void 0===this.phyEna&&this.initPhyUI();var t=this.vishva.getMeshPickedPhyParms();null!==t?(this.phyEna.setAttribute("checked","true"),this.phyType.value=Number(t.type).toString(),this.phyMass.value=Number(t.mass).toString(),this.phyRes.value=Number(t.restitution).toString(),this.phyResVal.value=this.formatValue(this.phyRes.value),this.phyFric.value=Number(t.friction).toString(),this.phyFricVal.value=this.formatValue(this.phyFric.value)):(this.phyEna.checked=!1,this.phyType.value="2",this.phyMass.value="1",this.phyRes.value="0",this.phyResVal.value="0.0",this.phyFric.value="0",this.phyFricVal.value="0.0")},t.prototype.applyPhysics=function(){var t;this.phyEna.checked?(t=new e.PhysicsParm,t.type=parseInt(this.phyType.value),t.mass=parseFloat(this.phyMass.value),t.restitution=parseFloat(this.phyRes.value),t.friction=parseFloat(this.phyFric.value)):t=null,this.vishva.setMeshPickedPhyParms(t)},t.prototype.testPhysics=function(){var t;t=new e.PhysicsParm,t.type=parseInt(this.phyType.value),t.mass=parseFloat(this.phyMass.value),t.restitution=parseFloat(this.phyRes.value),t.friction=parseFloat(this.phyFric.value),this.vishva.testPhysics(t)},t.prototype.resetPhysics=function(){this.vishva.resetPhysics()},t.prototype.createAlertDiag=function(){this.alertDiv=document.getElementById("alertDiv"),this.alertDialog=$("#alertDiv");var t={title:"Info",autoOpen:!1,width:"auto",minWidth:200,height:"auto",closeText:"",closeOnEscape:!1};this.alertDialog.dialog(t)},t.prototype.showAlertDiag=function(t){this.alertDiv.innerHTML="<h3>"+t+"</h3>",this.alertDialog.dialog("open")},t.prototype.sliderOptions=function(t,e,i){var s=this,n={};return n.min=t,n.max=e,n.value=i,n.slide=function(t,e){return s.handleSlide(t,e)},n},t.prototype.handleSlide=function(t,e){var i=t.target.id;if("fov"===i)this.vishva.setFov(e.value);else if("sunPos"===i)this.vishva.setSunPos(e.value);else{var s=e.value/100;"light"===i?this.vishva.setLight(s):"shade"===i?this.vishva.setShade(s):"fog"===i&&this.vishva.setFog(s/1e3)}return!0},t.prototype.createNavMenu=function(){var t=this,e=document.getElementById("showNavMenu");e.style.visibility="visible",document.getElementById("navMenubar").style.visibility="visible";var i=$("#navMenubar"),s={my:"left center",at:"right center",of:e};i.position(s),i.show(null),e.onclick=function(e){return t.menuBarOn?i.hide("slide",100):i.show("slide",100),t.menuBarOn=!t.menuBarOn,!0};var n=JSON.parse('{"direction":"up"}'),o=document.getElementById("navAdd"),a=$("#AddMenu");a.menu(),a.hide(null),o.onclick=function(e){if(t.firstTime){var i={my:"left top",at:"left bottom",of:o};a.menu().position(i),t.firstTime=!1}return t.addMenuOn?a.menu().hide("slide",n,100):a.show("slide",n,100),t.addMenuOn=!t.addMenuOn,$(document).one("click",function(e){return t.addMenuOn&&(a.menu().hide("slide",n,100),t.addMenuOn=!1),!0}),e.cancelBubble=!0,!0},document.getElementById("downWorld").onclick=function(e){var i=t.vishva.saveWorld();return null==i||(t.downloadLink.href=i,t.downloadDialog.dialog("open"),!1)},document.getElementById("navEnv").onclick=function(e){return void 0==t.envDiag&&t.createEnvDiag(),t.toggleDiag(t.envDiag),!1},document.getElementById("navEdit").onclick=function(e){return null!=t.propsDiag&&!0===t.propsDiag.dialog("isOpen")?t.closePropDiag():t.showPropDiag(),!0},document.getElementById("navSettings").onclick=function(e){return void 0==t.settingDiag&&t.createSettingDiag(),!1===t.settingDiag.dialog("isOpen")?(t.updateSettings(),t.settingDiag.dialog("open")):t.settingDiag.dialog("close"),!1},document.getElementById("helpLink").onclick=function(e){return t.toggleDiag(t.helpDiag),!0},document.getElementById("debugLink").onclick=function(e){return t.vishva.toggleDebug(),!0}},t.prototype.toggleDiag=function(t){!1===t.dialog("isOpen")?t.dialog("open"):t.dialog("close")},t.prototype.getSettings=function(){var t=new o;return t.enableToolTips=this.enableToolTips,t},t.prototype.setSettings=function(){var t=this.vishva.getGuiSettings();null!==t&&(this.enableToolTips=t.enableToolTips)},t}();n.LARGE_ICON_SIZE="width:128px;height:128px;",n.SMALL_ICON_SIZE="width:64px;height:64px;",i.VishvaGUI=n;var o=function(){function t(){}return t}();i.GuiSettings=o;var a=function(){function t(){this.r=0,this.g=0,this.b=0}return t}();i.RGB=a;var r=function(){function t(t,e,i,s){this.type="Range",this.min=0,this.max=0,this.value=0,this.step=0,this.min=t,this.max=e,this.value=i,this.step=s}return t}();i.Range=r;var h=function(){function t(){this.type="SelectType"}return t}();i.SelectType=h}(e.gui||(e.gui={}))}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){var e=function(){function t(){this.names=new Array,this.values=new Array;var t=window.location.search;t=t.substring(1);for(var e=t.split("&"),i=0;i<e.length;i++){var s=e[i],n=s.split("=");if(2===n.length){var o=n[0],a=n[1];this.names.push(o),this.values.push(a)}}}return t.prototype.getParm=function(t){var e=this.names.indexOf(t);return-1!==e?this.values[e]:null},t}();t.HREFsearch=e}(t.util||(t.util={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(e){!function(e){!function(e){var i=BABYLON.ActionManager,s=BABYLON.Animation,n=BABYLON.Axis,o=BABYLON.ExecuteCodeAction,a=t.ssatguru.babylonjs.vishva.gui.SelectType,r=t.ssatguru.babylonjs.vishva.gui.Range,h=BABYLON.Sound,l=BABYLON.Tags,c=BABYLON.Quaternion,u=BABYLON.Vector3,p=function(){function t(){this.sensorList=["Touch","Contact"],this.actuatorList=["Animator","Mover","Rotator","Sound","Cloaker","Disabler","Enabler"],this.snaDisabledList=new Array,this.sig2actMap=new Object,this.prevUID=""}return t.getSNAManager=function(){return null==t.sm&&(t.sm=new t),t.sm},t.prototype.setConfig=function(t){this.sensors=t.sensors,this.actuators=t.actuators,this.sensorList=Object.keys(this.sensors),this.actuatorList=Object.keys(this.actuators)},t.prototype.getSensorList=function(){return this.sensorList},t.prototype.getActuatorList=function(){return this.actuatorList},t.prototype.createSensorByName=function(t,e,i){return"Touch"===t?null!=i?new m(e,i):new m(e,new T):"Contact"===t?null!=i?new v(e,i):new v(e,new M):null},t.prototype.createActuatorByName=function(t,e,i){return"Mover"===t?null!=i?new k(e,i):new k(e,new x):"Rotator"===t?null!=i?new y(e,i):new y(e,new I):"Sound"===t?null!=i?new b(e,i):new b(e,new O):"Animator"===t?null!=i?new S(e,i):new S(e,new E):"Cloaker"===t?null!=i?new w(e,i):new w(e,new D):"Disabler"===t?null!=i?new P(e,i):new P(e,new L):"Enabler"===t?null!=i?new A(e,i):new A(e,new N):null},t.prototype.getSensorParms=function(t){return this.sensors[t].parms},t.prototype.getActuatorParms=function(t){return this.sensors[t].parms},t.prototype.emitSignal=function(t){var e=this;if(""!==t.trim()){var i=this.sig2actMap[t];null!=i&&window.setTimeout(function(t){return e.actuate(t)},0,i)}},t.prototype.actuate=function(t){for(var e=t,i=0;i<e.length;i++){e[i].start()}},t.prototype.processQueue=function(t){var e=t.actuators;if(null!=e)for(var i=0;i<e.length;i++){var s=e[i];s.processQueue()}},t.prototype.disableSnAs=function(t){this.snaDisabledList.push(t);var e=t.actuators;if(null!=e)for(var i=0;i<e.length;i++){var s=e[i];s.actuating&&s.stop()}},t.prototype.enableSnAs=function(t){var e=this.snaDisabledList.indexOf(t);-1!==e&&this.snaDisabledList.splice(e,1);var i=t.actuators;if(null!=i)for(var s=0;s<i.length;s++){var n=i[s];n.properties.autoStart&&n.start()}},t.prototype.removeSNAs=function(t){var e=t.actuators;if(null!=e)for(var i=e.length,s=i-1;s>=0;s--)e[s].dispose();var n=t.sensors;if(null!=n)for(var i=n.length,s=i-1;s>=0;s--)n[s].dispose();var s=this.snaDisabledList.indexOf(t);-1!==s&&this.snaDisabledList.splice(s,1)},t.prototype.subscribe=function(t,e){var i=this.sig2actMap[e];if(null==i){var s=new Array;s.push(t),this.sig2actMap[e]=s}else{var s=i;s.push(t)}},t.prototype.unSubscribe=function(t,e){var i=this.sig2actMap[e];if(null!=i){var s=i,n=s.indexOf(t);-1!==n&&s.splice(n,1)}},t.prototype.unSubscribeAll=function(){},t.prototype.serializeSnAs=function(t){for(var e,i,s=new Array,n=t.meshes,o=0;o<n.length;o++){var a=n[o];i=null;var r=a.actuators;if(null!=r){i=this.getMeshVishvaUid(a);for(var h=0;h<r.length;h++){var l=r[h];e=new d,e.name=l.getName(),e.type=l.getType(),e.meshId=i,e.properties=l.getProperties(),s.push(e)}}var c=a.sensors;if(null!=c){null==i&&(i=this.getMeshVishvaUid(a));for(var u=0;u<c.length;u++){var p=c[u];e=new d,e.name=p.getName(),e.type=p.getType(),e.meshId=i,e.properties=p.getProperties(),s.push(e)}}}return s},t.prototype.unMarshal=function(t,e){if(null!=t)for(var i=0;i<t.length;i++){var s=t[i],n=e.getMeshesByTags(s.meshId)[0];null!=n?"SENSOR"===s.type?this.createSensorByName(s.name,n,s.properties):"ACTUATOR"===s.type&&this.createActuatorByName(s.name,n,s.properties):console.log("didnot find mesh for tag "+s.meshId)}},t.prototype.getMeshVishvaUid=function(t){if(l.HasTags(t))for(var e=l.GetTags(t,!0).split(" "),i=0;i<e.length;i++){var s=e[i],n=s.indexOf("Vishva.uid.");if(n>=0)return s}var o;for(o="Vishva.uid."+new Number(Date.now()).toString();o===this.prevUID;)console.log("regenerating uid"),o="Vishva.uid."+new Number(Date.now()).toString();return this.prevUID=o,l.AddTagsTo(t,o),o},t}();e.SNAManager=p;var d=function(){function t(){}return t}();e.SNAserialized=d;var g=function(){function t(t,e){this.actions=new Array,this.properties=e,this.mesh=t;var i=this.mesh.sensors;null==i&&(i=new Array,t.sensors=i),i.push(this)}return t.prototype.dispose=function(){var t=this.mesh.sensors;if(null!=t){var e=t.indexOf(this);-1!==e&&t.splice(e,1)}this.removeActions(),this.cleanUp()},t.prototype.getSignalId=function(){return this.properties.signalId},t.prototype.setSignalId=function(t){this.properties.signalId=t},t.prototype.emitSignal=function(t){p.getSNAManager().snaDisabledList.indexOf(this.mesh)>=0||p.getSNAManager().emitSignal(this.properties.signalId)},t.prototype.getProperties=function(){return this.properties},t.prototype.setProperties=function(t){this.properties=t},t.prototype.processUpdateGeneric=function(){this.processUpdateSpecific()},t.prototype.getType=function(){return"SENSOR"},t.prototype.removeActions=function(){for(var t,e=this.mesh.actionManager.actions,i=0,s=this.actions;i<s.length;i++){var n=s[i];t=e.indexOf(n),e.splice(t,1)}0===e.length&&(this.mesh.actionManager.dispose(),this.mesh.actionManager=null)},t}();e.SensorAbstract=g;var m=function(t){function e(e,s){var n=t.call(this,e,s)||this;Object.defineProperty(n,"__interfaces",{configurable:!0,value:["org.ssatguru.babylonjs.Sensor","org.ssatguru.babylonjs.SensorActuator"]}),null==n.mesh.actionManager&&(n.mesh.actionManager=new i(n.mesh.getScene()));var a=new o(i.OnPickUpTrigger,function(t){0===t.sourceEvent.button&&n.emitSignal(t)});return n.mesh.actionManager.registerAction(a),n.actions.push(a),n}return __extends(e,t),e.prototype.getName=function(){return"Touch"},e.prototype.getProperties=function(){return this.properties},e.prototype.setProperties=function(t){this.properties=t},e.prototype.cleanUp=function(){},e.prototype.processUpdateSpecific=function(){},e}(g);e.SensorTouch=m;var v=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.processUpdateSpecific(),s}return __extends(e,t),e.prototype.getName=function(){return"Contact"},e.prototype.getProperties=function(){return this.properties},e.prototype.setProperties=function(t){this.properties=t},e.prototype.cleanUp=function(){},e.prototype.processUpdateSpecific=function(){var t=this,e=this.properties,s=this.mesh.getScene();null==this.mesh.actionManager&&(this.mesh.actionManager=new i(s));var n=s.getMeshesByTags("Vishva.avatar")[0];if(e.onEnter){var a=new o({trigger:i.OnIntersectionEnterTrigger,parameter:{mesh:n,usePreciseIntersection:!1}},function(e){return t.emitSignal(e)});this.mesh.actionManager.registerAction(a),this.actions.push(a)}if(e.onExit){var a=new o({trigger:i.OnIntersectionExitTrigger,parameter:{mesh:n,usePreciseIntersection:!1}},function(e){return t.emitSignal(e)});this.mesh.actionManager.registerAction(a),this.actions.push(a)}},e.prototype.findAV=function(t){for(var e=0;e<t.meshes.length;e++){var i=t.meshes[e];if(l.HasTags(i)&&l.MatchesQuery(i,"Vishva.avatar"))return i}return null},e}(g);e.SensorContact=v;var f=function(){function t(t,e){this.actuating=!1,this.ready=!0,this.queued=0,this.disposed=!1,Object.defineProperty(this,"__interfaces",{configurable:!0,value:["org.ssatguru.babylonjs.SensorActuator","org.ssatguru.babylonjs.Actuator"]}),this.properties=e,this.mesh=t,this.processUpdateGeneric();var i=this.mesh.actuators;null==i&&(i=new Array,this.mesh.actuators=i),i.push(this)}return t.prototype.start=function(){return!this.disposed&&(!!this.ready&&(!(p.getSNAManager().snaDisabledList.indexOf(this.mesh)>=0)&&(this.actuating?(this.properties.loop||this.queued++,!0):(p.getSNAManager().emitSignal(this.properties.signalStart),this.actuating=!0,this.actuate(),!0))))},t.prototype.processQueue=function(){this.queued>0&&(this.queued--,this.start())},t.prototype.getType=function(){return"ACTUATOR"},t.prototype.getMesh=function(){return this.mesh},t.prototype.getProperties=function(){return this.properties},t.prototype.setProperties=function(t){this.properties=t,this.processUpdateGeneric()},t.prototype.getSignalId=function(){return this.properties.signalId},t.prototype.processUpdateGeneric=function(){null!=this.signalId&&this.signalId!==this.properties.signalId?(p.getSNAManager().unSubscribe(this,this.signalId),this.signalId=this.properties.signalId,p.getSNAManager().subscribe(this,this.signalId)):null==this.signalId&&(this.signalId=this.properties.signalId,p.getSNAManager().subscribe(this,this.signalId)),this.processUpdateSpecific()},t.prototype.onActuateEnd=function(){return p.getSNAManager().emitSignal(this.properties.signalEnd),this.actuating=!1,this.queued>0?(this.queued--,this.start(),null):this.properties.loop?(this.start(),null):null},t.prototype.dispose=function(){this.disposed=!0,p.getSNAManager().unSubscribe(this,this.properties.signalId);var t=this.mesh.actuators;if(null!=t){this.stop();var e=t.indexOf(this);-1!==e&&t.splice(e,1)}this.cleanUp(),this.mesh=null},t}();e.ActuatorAbstract=f;var y=function(t){function e(e,i){var s=t.call(this,e,i)||this;return Object.defineProperty(s,"__interfaces",{configurable:!0,value:["org.ssatguru.babylonjs.SensorActuator","org.ssatguru.babylonjs.Actuator"]}),s}return __extends(e,t),e.prototype.actuate=function(){var t,e=this,i=this.properties,o=this.mesh.rotationQuaternion.clone(),a=c.RotationAxis(n.X,i.x*Math.PI/180),r=c.RotationAxis(n.Y,i.y*Math.PI/180),h=c.RotationAxis(n.Z,i.z*Math.PI/180),l=c.RotationYawPitchRoll(i.y*Math.PI/180,i.x*Math.PI/180,i.z*Math.PI/180);t=i.toggle?i.state_toggle?o.multiply(l):o.multiply(c.Inverse(l)):o.multiply(a).multiply(r).multiply(h),i.state_toggle=!i.state_toggle;this.mesh.position.y,this.mesh.position.y;this.a=s.CreateAndStartAnimation("rotate",this.mesh,"rotationQuaternion",60,60*i.duration,o,t,0,null,function(){return e.onActuateEnd()})},e.prototype.getName=function(){return"Rotator"},e.prototype.stop=function(){var t=this;null!=this.a&&(this.a.stop(),window.setTimeout(function(){return t.onActuateEnd()},0))},e.prototype.cleanUp=function(){},e.prototype.processUpdateSpecific=function(){if(this.properties.autoStart){this.start()}},e.prototype.isReady=function(){return!0},e}(f);e.ActuatorRotator=y;var k=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype.actuate=function(){var t,e,i=this,n=this.properties,o=this.mesh.position.clone();if(n.local){var a=this.mesh.getWorldMatrix(),r=new u(n.x*(1/this.mesh.scaling.x),n.y*(1/this.mesh.scaling.y),n.z*(1/this.mesh.scaling.z));e=u.TransformCoordinates(r,a).subtract(this.mesh.position)}else e=new u(n.x,n.y,n.z);n.toggle?(t=n.state_toggle?o.add(e):o.subtract(e),n.state_toggle=!n.state_toggle):t=o.add(e),this.a=s.CreateAndStartAnimation("move",this.mesh,"position",60,60*n.duration,o,t,0,null,function(){return i.onActuateEnd()})},e.prototype.getName=function(){return"Mover"},e.prototype.stop=function(){var t=this;null!=this.a&&(this.a.stop(),window.setTimeout(function(){return t.onActuateEnd()},0))},e.prototype.cleanUp=function(){},e.prototype.processUpdateSpecific=function(){if(this.properties.autoStart){this.start()}},e.prototype.isReady=function(){return!0},e}(f);e.ActuatorMover=k;var S=function(t){function e(e,i){var s=t.call(this,e,i)||this;Object.defineProperty(s,"__interfaces",{configurable:!0,value:["org.ssatguru.babylonjs.SensorActuator","org.ssatguru.babylonjs.Actuator"]});var n=e.skeleton;if(null!=n){for(var o=n.getAnimationRanges,a=o.call(n),r=new Array(a.length),h=0,l=0;l<a.length;l++){var c=a[l];r[h]=c.name,h++}i.animationRange.values=r}else i.animationRange.values=[""];return s}return __extends(e,t),e.prototype.actuate=function(){var t=this,e=this.properties;null!=this.mesh.skeleton&&this.mesh.skeleton.beginAnimation(e.animationRange.value,!1,e.rate,function(){return t.onActuateEnd()})},e.prototype.stop=function(){},e.prototype.isReady=function(){return!0},e.prototype.getName=function(){return"Animator"},e.prototype.processUpdateSpecific=function(){if(this.properties.autoStart){this.start()}},e.prototype.cleanUp=function(){this.properties.loop=!1},e}(f);e.ActuatorAnimator=S;var w=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.s=1,s.e=0,s}return __extends(e,t),e.prototype.actuate=function(){var t=this,e=this.properties;e.toggle?(e.state_toggle?(this.s=1,this.e=0):(this.s=0,this.e=1),e.state_toggle=!e.state_toggle):(this.s=1,this.e=0),this.a=s.CreateAndStartAnimation("cloaker",this.mesh,"visibility",60,60*e.timeToCloak,this.s,this.e,0,null,function(){return t.onActuateEnd()})},e.prototype.stop=function(){var t=this;null!=this.a&&(this.a.stop(),window.setTimeout(function(){return t.onActuateEnd()},0))},e.prototype.isReady=function(){return!0},e.prototype.getName=function(){return"Cloaker"},e.prototype.processUpdateSpecific=function(){if(this.properties.autoStart){this.start()}},e.prototype.cleanUp=function(){this.properties.loop=!1},e}(f);e.ActuatorCloaker=w;var P=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype.actuate=function(){var t=!1;this.properties.toggle?(t=!this.properties.state_toggle,this.properties.state_toggle=!this.properties.state_toggle):t=!1,this.mesh.setEnabled(t),this.onActuateEnd()},e.prototype.stop=function(){this.mesh.setEnabled(!0)},e.prototype.isReady=function(){return!0},e.prototype.getName=function(){return"Disabler"},e.prototype.processUpdateSpecific=function(){if(this.properties.autoStart){this.start()}},e.prototype.cleanUp=function(){this.properties.loop=!1},e}(f);e.ActuatorDisabler=P;var A=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype.actuate=function(){var t=!1;this.properties.toggle?(t=!!this.properties.state_toggle,this.properties.state_toggle=!this.properties.state_toggle):t=!0,this.mesh.setEnabled(t),this.onActuateEnd()},e.prototype.stop=function(){this.mesh.setEnabled(!1)},e.prototype.isReady=function(){return!0},e.prototype.getName=function(){return"Enabler"},e.prototype.processUpdateSpecific=function(){if(this.properties.autoStart){this.start()}},e.prototype.cleanUp=function(){this.properties.loop=!1},e}(f);e.ActuatorEnabler=A;var b=function(t){function e(e,i){var s=t.call(this,e,i)||this;return Object.defineProperty(s,"__interfaces",{configurable:!0,value:["org.ssatguru.babylonjs.SensorActuator","org.ssatguru.babylonjs.Actuator"]}),s}return __extends(e,t),e.prototype.actuate=function(){var t=this;this.properties.toggle?(this.properties.state_toggle?this.sound.play():window.setTimeout(function(){return t.onActuateEnd()},0),this.properties.state_toggle=!this.properties.state_toggle):this.sound.play()},e.prototype.processUpdateSpecific=function(){var t=this,e=this.properties;null!=e.soundFile.value&&(null==this.sound||e.soundFile.value!==this.sound.name?(null!=this.sound&&(this.stop(),this.sound.dispose()),this.ready=!1,this.sound=new h(e.soundFile.value,"vishva/assets/sounds/"+e.soundFile.value,this.mesh.getScene(),function(e){return function(){t.updateSound(e)}}(e))):(this.stop(),this.updateSound(e)))},e.prototype.updateSound=function(t){var e=this;if(this.ready=!0,t.attachToMesh&&this.sound.attachToMesh(this.mesh),this.sound.onended=function(){return e.onActuateEnd()},this.sound.setVolume(t.volume.value),t.autoStart){this.start()||this.queued++}},e.prototype.getName=function(){return"Sound"},e.prototype.stop=function(){var t=this;null!=this.sound&&this.sound.isPlaying&&(this.sound.stop(),window.setTimeout(function(){return t.onActuateEnd()},0))},e.prototype.cleanUp=function(){},e.prototype.isReady=function(){return this.ready},e}(f);e.ActuatorSound=b;var C=function(){function t(){this.signalId="0",this.signalEnable="",this.signalDisble=""}return t}();e.SNAproperties=C;var T=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.unmarshall=function(t){return t},e}(C);e.SenTouchProp=T;var M=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onEnter=!1,e.onExit=!1,e}return __extends(e,t),e.prototype.unmarshall=function(t){return t},e}(C);e.SenContactProp=M;var B=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.signalStart="",e.signalEnd="",e.autoStart=!1,e.loop=!1,e.toggle=!0,e.state_toggle=!0,e}return __extends(e,t),e}(C);e.ActProperties=B;var I=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.x=0,e.y=90,e.z=0,e.duration=1,e}return __extends(e,t),e.prototype.unmarshall=function(t){return t},e}(B);e.ActRotatorParm=I;var x=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.x=1,e.y=1,e.z=1,e.duration=1,e.local=!1,e}return __extends(e,t),e.prototype.unmarshall=function(t){return t},e}(B);e.ActMoverParm=x;var E=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.animationRange=new a,e.rate=1,e}return __extends(e,t),e.prototype.unmarshall=function(t){return null},e}(B);e.AnimatorProp=E;var O=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.soundFile=new a,e.attachToMesh=!1,e.volume=new r(0,1,1,.1),e}return __extends(e,t),e.prototype.unmarshall=function(t){return null},e}(B);e.ActSoundProp=O;var D=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.timeToCloak=1,e}return __extends(e,t),e.prototype.unmarshall=function(t){return null},e}(B);e.ActCloakerProp=D;var L=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.unmarshall=function(t){return null},e}(B);e.ActDisablerProp=L;var N=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.unmarshall=function(t){return null},e}(B);e.ActEnablerProp=N}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(e){!function(e){!function(e){var i=t.ssatguru.babylonjs.component.EditControl,s=t.ssatguru.babylonjs.component.CharacterControl,n=BABYLON.Animation,o=BABYLON.ArcRotateCamera,a=BABYLON.AssetsManager,r=BABYLON.Color3,h=BABYLON.Color4,l=BABYLON.CubeTexture,c=BABYLON.CSG,u=BABYLON.DirectionalLight,p=BABYLON.Engine,d=BABYLON.HemisphericLight,g=BABYLON.Light,m=BABYLON.Matrix,v=BABYLON.Mesh,f=BABYLON.MeshBuilder,y=BABYLON.ParticleSystem,k=BABYLON.PhysicsImpostor,S=BABYLON.Quaternion,w=BABYLON.Scene,P=BABYLON.SceneLoader,A=BABYLON.SceneSerializer,b=BABYLON.ShadowGenerator,C=BABYLON.Debug.SkeletonViewer,T=BABYLON.StandardMaterial,M=BABYLON.Tags,B=BABYLON.Texture,I=BABYLON.Vector3,x=t.ssatguru.babylonjs.vishva.gui.VishvaGUI,E=BABYLON.WaterMaterial,O=function(){function t(t,e,i,s,n){var o=this;if(this.actuator="none",this.snapTransOn=!1,this.snapRotOn=!1,this.snapScaleOn=!1,this.snapperOn=!1,this.snapTransValue=.5,this.snapRotValue=Math.PI/4,this.snapScaleValue=.5,this.ow=.01,this.spaceWorld=!1,this.skyboxTextures="vishva/internal/textures/skybox-default/default",this.avatarFolder="vishva/internal/avatar/",this.avatarFile="starterAvatars.babylon",this.groundTexture="vishva/internal/textures/ground.jpg",this.groundHeightMap="vishva/internal/textures/ground_heightMap.png",this.primTexture="vishva/internal/textures/Birch.jpg",this.waterTexture="vishva/internal/textures/waterbump.png",this.snowTexture="vishva/internal/textures/flare.png",this.rainTexture="vishva/internal/textures/raindrop-1.png",this.snowPart=null,this.snowing=!1,this.rainPart=null,this.raining=!1,this.SOUND_ASSET_LOCATION="vishva/assets/sounds/",this.RELATIVE_ASSET_LOCATION="",this.switchDisabled=!1,this.keysDisabled=!1,this.showBoundingBox=!1,this.cameraCollision=!0,this.autoEditMenu=!0,this.enablePhysics=!0,this.vishvaSerialized=null,this.isFocusOnAv=!0,this.cameraAnimating=!1,this.moveLimitStart=114,this.moveLimitEnd=124,this.oldAvPos=new I(0,0,0),this.fogDensity=0,this.meshesPicked=null,this.isMeshSelected=!1,this.cameraTargetPos=new I(0,0,0),this.saveAVcameraPos=new I(0,0,0),this.animFunc=function(){return o.animateCamera()},this.animFunc2=function(){return o.justReFocus()},this.showingAllInvisibles=!1,this.meshPickedPhyParms=null,this.didPhysTest=!1,this.skelViewerArr=[],this.debugVisible=!1,this.editEnabled=!1,this.frames=0,this.f=0,!p.isSupported())return void alert("not supported");this.loadingMsg=document.getElementById("loadingMsg"),this.loadingMsg.style.visibility="visible",this.loadingStatus=document.getElementById("loadingStatus"),this.editEnabled=s,this.assets=n,this.key=new D,this.initAnims(),this.canvas=document.getElementById(i),this.engine=new p(this.canvas,!0),this.scene=new w(this.engine),this.scene.enablePhysics(),this.scene.clearColor=new h(0,0,0,1),this.scene.ambientColor=new r(1,1,1),this.scene.fogColor=new BABYLON.Color3(.9,.9,.85),window.addEventListener("resize",function(t){return o.onWindowResize(t)}),window.addEventListener("keydown",function(t){return o.onKeyDown(t)},!1),window.addEventListener("keyup",function(t){return o.onKeyUp(t)},!1),this.scenePath=t,null==e?this.onSceneLoaded(this.scene):(this.loadingStatus.innerHTML="downloading world",this.loadSceneFile(t,e+".js",this.scene))}return t.prototype.loadSceneFile=function(t,e,i){var s=this,n=new a(i),o=n.addTextFileTask("sceneLoader",t+e);o.onSuccess=function(t){return s.onTaskSuccess(t)},o.onError=function(t){return s.onTaskFailure(t)},n.load()},t.prototype.getGuiSettings=function(){return null!==this.vishvaSerialized?this.vishvaSerialized.guiSettings:null},t.prototype.onTaskSuccess=function(t){var e=this,i=t,s=JSON.parse(i.text);this.vishvaSerialized=s.VishvaSerialized,this.snas=this.vishvaSerialized.snas,this.cameraCollision=this.vishvaSerialized.settings.cameraCollision,this.autoEditMenu=this.vishvaSerialized.settings.autoEditMenu;var n="data:"+i.text;P.ShowLoadingScreen=!1,this.loadingStatus.innerHTML="loading scene",P.Append("",n,this.scene,function(t){return e.onSceneLoaded(t)})},t.prototype.onTaskFailure=function(t){alert("scene load failed")},t.prototype.setShadowProperty=function(t,e){e.useBlurExponentialShadowMap=!0},t.prototype.onSceneLoaded=function(t){var i=this;this.loadingStatus.innerHTML="checking assets";for(var n=!1,o=!1,a=!1,h=!1,l=!1,c=!1,p=0,g=t.meshes;p<g.length;p++){var m=g[p];m.receiveShadows=!1,M.HasTags(m)&&(M.MatchesQuery(m,"Vishva.avatar")?(n=!0,this.avatar=m,this.avatar.ellipsoidOffset=new I(0,2,0)):M.MatchesQuery(m,"Vishva.sky")?(l=!0,this.skybox=m,this.skybox.isPickable=!1):M.MatchesQuery(m,"Vishva.ground")&&(h=!0,this.ground=m))}for(var v=0,f=t.skeletons;v<f.length;v++){var y=f[v];(M.MatchesQuery(y,"Vishva.skeleton")||"Vishva.skeleton"===y.name)&&(o=!0,this.avatarSkeleton=y,this.checkAnimRange(this.avatarSkeleton))}o||console.error("ALARM: No Skeleton found");for(var k=0,S=t.lights;k<S.length;k++){var P=S[k];M.MatchesQuery(P,"Vishva.sun")&&(a=!0,this.sun=P)}if(a)for(var A=0,C=t.lights;A<C.length;A++){var P=C[A];if("Vishva.dl01"===P.id){this.sunDR=P,this.shadowGenerator=P.getShadowGenerator();var T=this.sunDR;this.setShadowProperty(T,this.shadowGenerator)}}else{console.log("no vishva sun found. creating sun"),this.sun=new d("Vishva.hl01",new I(0,1,0),this.scene),this.sun.groundColor=new r(.5,.5,.5),M.AddTagsTo(this.sun,"Vishva.sun"),this.sunDR=new u("Vishva.dl01",new I(-1,-1,0),this.scene),this.sunDR.position=new I(0,1048,0);var T=this.sunDR;this.shadowGenerator=new b(1024,T),this.setShadowProperty(T,this.shadowGenerator)}for(var B=0,x=t.meshes;B<x.length;B++){var m=x[B];null!=m&&m instanceof BABYLON.InstancedMesh&&this.shadowGenerator.getShadowMap().renderList.push(m)}for(var E=0,O=t.cameras;E<O.length;E++){var D=O[E];M.MatchesQuery(D,"Vishva.camera")&&(c=!0,this.mainCamera=D,this.setCameraSettings(this.mainCamera),
this.mainCamera.attachControl(this.canvas,!0))}c||(console.log("no vishva camera found. creating camera"),this.mainCamera=this.createCamera(this.scene,this.canvas),this.scene.activeCamera=this.mainCamera),this.mainCamera.checkCollisions=!0,this.mainCamera.collisionRadius=new I(.5,.5,.5),h?this.ground.receiveShadows=!0:(console.log("no vishva ground found. creating ground"),this.createGround_htmap(this.scene)),l||(console.log("no vishva sky found. creating sky"),this.skybox=this.createSkyBox(this.scene),this.setLight(.5)),this.scene.fogMode!==w.FOGMODE_EXP2&&(this.scene.fogMode=w.FOGMODE_EXP2,this.scene.fogDensity=0),this.editEnabled&&(this.scene.onPointerDown=function(t,e){return i.pickObject(t,e)}),n?(this.avatarSkeleton.enableBlending(.1),this.cc=new s(this.avatar,this.avatarSkeleton,this.anims,this.mainCamera,this.scene),this.cc.start()):(console.log("no vishva av found. creating av"),this.loadAvatar()),e.SNAManager.getSNAManager().unMarshal(this.snas,this.scene),this.snas=null,this.render()},t.prototype.render=function(){var t=this;this.scene.registerBeforeRender(function(){return t.process()}),this.scene.executeWhenReady(function(){return t.startRenderLoop()})},t.prototype.startRenderLoop=function(){var t=this;this.backfaceCulling(this.scene.materials),this.editEnabled?this.vishvaGUI=new x(this):this.vishvaGUI=null,this.engine.hideLoadingUI(),this.loadingMsg.style.visibility="hidden",this.engine.runRenderLoop(function(){return t.scene.render()})},t.prototype.process=function(){if(this.sunDR.position.x=this.avatar.position.x+100,this.sunDR.position.y=this.avatar.position.y+100,this.sunDR.position.z=this.avatar.position.z+0,!this.cameraAnimating){if(this.keysDisabled&&!this.key.esc)return void this.resetKeys();this.isFocusOnAv&&(this.mainCamera.radius<=.75?(this.mainCamera.radius=.75,this.avatar.visibility=0,this.mainCamera.checkCollisions=!1):(this.avatar.visibility=1,this.mainCamera.checkCollisions=this.cameraCollision)),this.isMeshSelected&&(this.key.focus&&this.setFocusOnMesh(),this.key.esc&&(this.key.esc=!1,this.removeEditControl()),this.key.trans&&this.setTransOn(),this.key.rot&&this.setRotOn(),this.key.scale&&this.setScaleOn()),this.isFocusOnAv?null==this.editControl||this.editControl.isEditing():(this.key.up||this.key.down||this.key.esc)&&(null==this.editControl?this.switchFocusToAV():this.editControl.isEditing()||this.switchFocusToAV()),this.key.esc&&this.multiUnSelectAll(),this.resetKeys()}},t.prototype.resetKeys=function(){this.key.focus=!1,this.key.esc=!1,this.key.trans=!1,this.key.rot=!1,this.key.scale=!1},t.prototype.moveAVandCamera=function(){if(this.oldAvPos.copyFrom(this.avatar.position),this.cc.moveAVandCamera()){var t=this.avatar.position.length();t>this.moveLimitStart?this.scene.fogDensity=this.fogDensity+.01*(t-this.moveLimitStart)/(this.moveLimitEnd-this.moveLimitStart):this.scene.fogDensity=this.fogDensity,t>this.moveLimitEnd&&this.avatar.position.copyFrom(this.oldAvPos)}},t.prototype.pickObject=function(t,e){if(t.preventDefault(),2===t.button&&e.hit){if(this.key.ctl&&(!this.isMeshSelected||e.pickedMesh!==this.meshPicked))return void this.multiSelect(e.pickedMesh);if(this.isMeshSelected)if(e.pickedMesh===this.meshPicked){if(this.key.ctl)return;this.setFocusOnMesh()}else this.multiUnSelect(e.pickedMesh),this.switchEditControl(e.pickedMesh),this.snapperOn&&this.snapToGlobal();else this.selectForEdit(e.pickedMesh)}},t.prototype.selectForEdit=function(t){var s=this;this.multiUnSelect(t),this.isMeshSelected=!0,this.meshPicked=t,e.SNAManager.getSNAManager().disableSnAs(this.meshPicked),this.savePhyParms(),this.switchToQuats(this.meshPicked),this.editControl=new i(this.meshPicked,this.mainCamera,this.canvas,.75),this.editControl.addActionListener(function(t){s.vishvaGUI.refreshGeneralPanel()}),this.editControl.enableTranslation(),this.spaceWorld&&this.editControl.setLocal(!1),this.autoEditMenu&&this.vishvaGUI.showPropDiag(),this.snapperOn?this.setSnapperOn():(this.snapTransOn&&(this.editControl.setTransSnap(!0),this.editControl.setTransSnapValue(this.snapTransValue)),this.snapRotOn&&(this.editControl.setRotSnap(!0),this.editControl.setRotSnapValue(this.snapRotValue)),this.snapScaleOn&&(this.editControl.setScaleSnap(!0),this.editControl.setScaleSnapValue(this.snapScaleValue)))},t.prototype.switchEditControl=function(t){if(!this.switchDisabled){e.SNAManager.getSNAManager().enableSnAs(this.meshPicked),this.restorePhyParms();this.meshPicked;this.meshPicked=t,this.savePhyParms(),this.switchToQuats(this.meshPicked),this.editControl.switchTo(this.meshPicked),e.SNAManager.getSNAManager().disableSnAs(this.meshPicked),this.vishvaGUI.refreshPropsDiag()}},t.prototype.switchToQuats=function(t){if(void 0===t.rotationQuaternion||null===t.rotationQuaternion){var e=t.rotation;t.rotationQuaternion=S.RotationYawPitchRoll(e.y,e.x,e.z)}},t.prototype.multiSelect_old=function(t,e){null==this.meshesPicked&&(this.meshesPicked=new Array);var i;null!=t&&((i=this.meshesPicked.indexOf(t))>=0||(this.meshesPicked.push(t),t.renderOutline=!0,t.outlineWidth=this.ow)),i=this.meshesPicked.indexOf(e),i>=0?(this.meshesPicked.splice(i,1),this.meshPicked.renderOutline=!1):(this.meshesPicked.push(e),e.renderOutline=!0,e.outlineWidth=this.ow)},t.prototype.multiSelect=function(t){null==this.meshesPicked&&(this.meshesPicked=new Array),this.multiUnSelect(t)||(this.meshesPicked.push(t),t.renderOutline=!0,t.outlineWidth=this.ow)},t.prototype.multiUnSelect=function(t){if(null==this.meshesPicked)return!1;var e=this.meshesPicked.indexOf(t);return e>=0&&(this.meshesPicked.splice(e,1),t.renderOutline=!1,!0)},t.prototype.multiUnSelectAll=function(){if(null!==this.meshesPicked){for(var t=0,e=this.meshesPicked;t<e.length;t++){e[t].renderOutline=!1}this.meshesPicked=null}},t.prototype.removeEditControl=function(){this.multiUnSelectAll(),this.isMeshSelected=!1,this.editControl.detach(),this.editControl=null,this.autoEditMenu&&this.vishvaGUI.closePropDiag(),this.vishvaGUI.closePropsDiag(),null!=this.meshPicked&&(e.SNAManager.getSNAManager().enableSnAs(this.meshPicked),this.restorePhyParms())},t.prototype.switchFocusToAV=function(){this.mainCamera.detachControl(this.canvas),this.frames=25,this.f=this.frames,this.delta=this.saveAVcameraPos.subtract(this.mainCamera.position).scale(1/this.frames);var t=new I(this.avatar.position.x,this.avatar.position.y+1.5,this.avatar.position.z);this.delta2=t.subtract(this.mainCamera.target).scale(1/this.frames),this.cameraAnimating=!0,this.scene.registerBeforeRender(this.animFunc)},t.prototype.focusOnMesh=function(t,e){this.mainCamera.detachControl(this.canvas),this.frames=e,this.f=e,this.delta2=t.getAbsolutePivotPoint().subtract(this.mainCamera.target).scale(1/this.frames),this.cameraAnimating=!0,this.scene.registerBeforeRender(this.animFunc2)},t.prototype.animateCamera=function(){new I(this.avatar.position.x,this.avatar.position.y+1.5,this.avatar.position.z).subtract(this.mainCamera.target).length()>.01&&this.mainCamera.setTarget(this.mainCamera.target.add(this.delta2)),this.saveAVcameraPos.subtract(this.mainCamera.position).length()>.01&&this.mainCamera.setPosition(this.mainCamera.position.add(this.delta)),--this.f<0&&(this.isFocusOnAv=!0,this.cameraAnimating=!1,this.scene.unregisterBeforeRender(this.animFunc),this.mainCamera.attachControl(this.canvas),this.cc.start())},t.prototype.justReFocus=function(){this.mainCamera.setTarget(this.mainCamera.target.add(this.delta2)),--this.f<0&&(this.cameraAnimating=!1,this.scene.unregisterBeforeRender(this.animFunc2),this.mainCamera.attachControl(this.canvas))},t.prototype.initAnims=function(){var t,e,i,s,n,o,a,r,h;t=new L("walk",7,35,1),e=new L("walkBack",39,65,.5),i=new L("idle",203,283,1),s=new L("run",69,95,1),n=new L("jump",101,103,.5),o=new L("turnLeft",107,151,.5),a=new L("turnRight",155,199,.5),r=new L("strafeLeft",0,0,1),h=new L("strafeRight",0,0,1),this.anims=[t,e,i,s,n,o,a,r,h]},t.prototype.onWindowResize=function(t){this.engine.resize()},t.prototype.onKeyDown=function(t){var e=t;17===e.keyCode&&(this.key.ctl=!0),27===e.keyCode&&(this.key.esc=!1);var i=String.fromCharCode(e.keyCode);"W"!==i&&38!==e.keyCode||(this.key.up=!0),"S"!==i&&40!==e.keyCode||(this.key.down=!0),"1"===i&&(this.key.trans=!1),"2"===i&&(this.key.rot=!1),"3"===i&&(this.key.scale=!1),"F"===i&&(this.key.focus=!1)},t.prototype.onKeyUp=function(t){var e=t;17===e.keyCode&&(this.key.ctl=!1),27===e.keyCode&&(this.key.esc=!0);var i=String.fromCharCode(e.keyCode);"W"!==i&&38!==e.keyCode||(this.key.up=!1),"S"!==i&&40!==e.keyCode||(this.key.down=!1),"1"===i&&(this.key.trans=!0),"2"===i&&(this.key.rot=!0),"3"===i&&(this.key.scale=!0),"F"===i&&(this.key.focus=!0)},t.prototype.createPrimMaterial=function(){this.primMaterial=new T("primMat",this.scene),this.primMaterial.diffuseTexture=new B(this.primTexture,this.scene),this.primMaterial.diffuseColor=new r(1,1,1),this.primMaterial.specularColor=new r(0,0,0)},t.prototype.setPrimProperties=function(t){null==this.primMaterial&&this.createPrimMaterial();var e=t.getBoundingInfo().boundingSphere.radiusWorld,i=new I(0,e,-(e+2)),s=I.TransformCoordinates(i,this.avatar.getWorldMatrix());t.position.addInPlace(s),t.material=this.primMaterial,t.checkCollisions=!0,this.shadowGenerator.getShadowMap().renderList.push(t),M.AddTagsTo(t,"Vishva.prim Vishva.internal"),t.id=new Number(Date.now()).toString(),t.name=t.id},t.prototype.addPrim=function(t){var e=null;"plane"===t?e=this.addPlane():"box"===t?e=this.addBox():"sphere"===t?e=this.addSphere():"disc"===t?e=this.addDisc():"cylinder"===t?e=this.addCylinder():"cone"===t?e=this.addCone():"torus"===t&&(e=this.addTorus()),null!==e&&(this.isMeshSelected?this.switchEditControl(e):this.selectForEdit(e),this.animateMesh(e))},t.prototype.addPlane=function(){var t=v.CreatePlane("",1,this.scene);return this.setPrimProperties(t),t.material.backFaceCulling=!1,t},t.prototype.addBox=function(){var t=v.CreateBox("",1,this.scene);return this.setPrimProperties(t),t},t.prototype.addSphere=function(){var t=v.CreateSphere("",10,1,this.scene);return this.setPrimProperties(t),t},t.prototype.addDisc=function(){var t=v.CreateDisc("",.5,20,this.scene);return this.setPrimProperties(t),t.material.backFaceCulling=!1,t},t.prototype.addCylinder=function(){var t=v.CreateCylinder("",1,1,1,20,1,this.scene);return this.setPrimProperties(t),t},t.prototype.addCone=function(){var t=v.CreateCylinder("",1,0,1,20,1,this.scene);return this.setPrimProperties(t),t},t.prototype.addTorus=function(){var t=v.CreateTorus("",1,.25,20,this.scene);return this.setPrimProperties(t),t},t.prototype.switchGround=function(){return this.isMeshSelected?(M.RemoveTagsFrom(this.ground,"Vishva.ground"),this.ground.isPickable=!0,this.ground=this.meshPicked,this.ground.isPickable=!1,M.AddTagsTo(this.ground,"Vishva.ground"),this.removeEditControl(),null):"no mesh selected"},t.prototype.instance_mesh=function(){if(!this.isMeshSelected)return"no mesh selected";if(null!=this.meshPicked&&this.meshPicked instanceof BABYLON.InstancedMesh)return"this is an instance mesh. you cannot create instance of that";var t=new Number(Date.now()).toString(),e=this.meshPicked.createInstance(t);return this.animateMesh(e),this.meshPicked=e,this.switchEditControl(e),this.shadowGenerator.getShadowMap().renderList.push(e),null},t.prototype.toggleCollision=function(){if(!this.isMeshSelected)return"no mesh selected";this.meshPicked.checkCollisions=!this.meshPicked.checkCollisions},t.prototype.enableCollision=function(t){this.meshPicked.checkCollisions=t},t.prototype.isCollideable=function(){return this.meshPicked.checkCollisions},t.prototype.toggleEnable=function(){if(!this.isMeshSelected)return"no mesh selected";this.meshPicked.setEnabled(!this.meshPicked.isEnabled())},t.prototype.disableIt=function(t){this.meshPicked.setEnabled(!t)},t.prototype.isDisabled=function(){return!this.meshPicked.isEnabled()},t.prototype.showAllDisabled=function(){for(var t=0,e=this.scene.meshes;t<e.length;t++){var i=e[t];i.isEnabled()||(i.renderOutline=!0,i.outlineWidth=this.ow)}},t.prototype.hideAllDisabled=function(){for(var t=0,e=this.scene.meshes;t<e.length;t++){var i=e[t];i.isEnabled()||(i.renderOutline=!1)}},t.prototype.makeVisibile=function(t){if(!this.isMeshSelected)return"no mesh selected";var e=this.meshPicked;t?M.HasTags(e)&&M.MatchesQuery(e,"invisible")&&(M.RemoveTagsFrom(this.meshPicked,"invisible"),this.meshPicked.visibility=1,this.meshPicked.isPickable=!0,this.showingAllInvisibles&&(e.renderOutline=!1)):(M.AddTagsTo(this.meshPicked,"invisible"),this.showingAllInvisibles?(this.meshPicked.visibility=.5,e.renderOutline=!0,e.outlineWidth=this.ow,this.meshPicked.isPickable=!0):(this.meshPicked.visibility=0,this.meshPicked.isPickable=!1))},t.prototype.isVisible=function(){return!M.HasTags(this.meshPicked)||!M.MatchesQuery(this.meshPicked,"invisible")},t.prototype.showAllInvisibles=function(){this.showingAllInvisibles=!0;for(var t=0;t<this.scene.meshes.length;t++){var e=this.scene.meshes[t];M.HasTags(e)&&M.MatchesQuery(e,"invisible")&&(e.visibility=.5,e.renderOutline=!0,e.outlineWidth=this.ow,e.isPickable=!0)}},t.prototype.hideAllInvisibles=function(){this.showingAllInvisibles=!1;for(var t=0;t<this.scene.meshes.length;t++)for(var t=0;t<this.scene.meshes.length;t++){var e=this.scene.meshes[t];M.HasTags(e)&&M.MatchesQuery(e,"invisible")&&(e.visibility=0,e.renderOutline=!1,e.isPickable=!1)}},t.prototype.makeParent=function(){if(!this.isMeshSelected)return"no mesh selected";if(null==this.meshesPicked||0===this.meshesPicked.length)return"select atleast two mesh. use 'ctl' and mosue right click to select multiple meshes";this.meshPicked.computeWorldMatrix(!0);for(var t,e=m.Invert(this.meshPicked.getWorldMatrix()),i=0;i<this.meshesPicked.length;i++){var s=this.meshesPicked[i];s.computeWorldMatrix(!0),s===this.meshPicked.parent&&(t=this.meshPicked.getWorldMatrix(),t.decompose(this.meshPicked.scaling,this.meshPicked.rotationQuaternion,this.meshPicked.position),this.meshPicked.parent=null),s!==this.meshPicked&&(s.renderOutline=!1,t=s.getWorldMatrix().multiply(e),t.decompose(s.scaling,s.rotationQuaternion,s.position),s.parent=this.meshPicked)}return this.meshPicked.renderOutline=!1,this.meshesPicked=null,null},t.prototype.removeParent=function(){return this.isMeshSelected?null==this.meshPicked.parent?"this mesh has no parent":(this.meshPicked.getWorldMatrix().decompose(this.meshPicked.scaling,this.meshPicked.rotationQuaternion,this.meshPicked.position),this.meshPicked.parent=null,"parent removed"):"no mesh selected"},t.prototype.removeChildren=function(){if(!this.isMeshSelected)return"no mesh selected";var t=this.meshPicked,e=t.getChildren();if(0===e.length)return"this mesh has no children";for(var i,s=0,n=0;n<e.length;n++){var o=e[n];i=o.getWorldMatrix(),i.decompose(o.scaling,o.rotationQuaternion,o.position),o.parent=null,s++}return s+" children removed"},t.prototype.clone_mesh=function(){if(!this.isMeshSelected)return"no mesh selected";if(null!=this.meshPicked&&this.meshPicked instanceof BABYLON.InstancedMesh)return"this is an instance mesh. you cannot clone these";var t,e=new Array;if(null!=this.meshesPicked)for(var i=0,s=this.meshesPicked;i<s.length;i++){var n=s[i];n!==this.meshPicked&&(null!=n&&n instanceof BABYLON.InstancedMesh||(t=this.clonetheMesh(n),e.push(t)))}return t=this.clonetheMesh(this.meshPicked),null!=this.meshesPicked&&(e.push(t),this.meshesPicked=e),this.switchEditControl(t),null},t.prototype.clonetheMesh=function(t){var e=new Number(Date.now()).toString(),i=t.clone(e,null,!0);return console.log(t.scaling),i.scaling.copyFrom(t.scaling),delete i.sensors,delete i.actuators,this.animateMesh(i),t.renderOutline=!1,this.shadowGenerator.getShadowMap().renderList.push(i),i},t.prototype.animateMesh=function(t){var e=t.scaling.clone().scaleInPlace(1.5),i=t.scaling.clone();n.CreateAndStartAnimation("boxscale",t,"scaling",10,2,e,i,0)},t.prototype.delete_mesh=function(){if(!this.isMeshSelected)return"no mesh selected";if(null!=this.meshesPicked){for(var t=0;t<this.meshesPicked.length;t++){var e=this.meshesPicked[t];e!==this.meshPicked&&this.deleteTheMesh(e)}this.meshesPicked=null}return this.deleteTheMesh(this.meshPicked),this.meshPicked=null,this.removeEditControl(),null},t.prototype.deleteTheMesh=function(t){e.SNAManager.getSNAManager().removeSNAs(t);var i=this.shadowGenerator.getShadowMap().renderList,s=i.indexOf(t);s>=0&&i.splice(s,1),t.dispose()},t.prototype.mergeMeshes_old=function(){if(null!=this.meshesPicked){for(var t=0,e=this.meshesPicked;t<e.length;t++){if(e[t]instanceof BABYLON.InstancedMesh)return"some of your meshes are instance meshes. cannot merge those"}this.meshesPicked.push(this.meshPicked);var i=this.meshesPicked,s=v.MergeMeshes(i,!1);this.meshesPicked.pop();this.meshPicked.position.multiplyByFloats(-1,-1,-1);return s.setPivotPoint(this.meshPicked.position.clone()),s.position=this.meshPicked.position.clone(),this.switchEditControl(s),this.animateMesh(s),null}return"please select two or more mesh"},t.prototype.mergeMeshes=function(){if(null!=this.meshesPicked){for(var t=0,e=this.meshesPicked;t<e.length;t++){var i=e[t];if(i instanceof BABYLON.InstancedMesh)return"some of your meshes are instance meshes. cannot merge those"}this.meshesPicked.push(this.meshPicked);for(var s=new Array(this.meshesPicked.length),n=0,o=0,a=this.meshesPicked;o<a.length;o++){var i=a[o];s[n]=i.position.clone(),n++,i.position.subtractInPlace(this.meshPicked.position)}var r=this.meshesPicked,h=v.MergeMeshes(r,!1);n=0;for(var l=0,c=this.meshesPicked;l<c.length;l++){var i=c[l];i.position=s[n],n++}return this.meshesPicked.pop(),h.position=this.meshPicked.position.clone(),this.switchEditControl(h),this.animateMesh(h),this.shadowGenerator.getShadowMap().renderList.push(h),this.multiUnSelectAll(),null}return"select two or more mesh"},t.prototype.csgOperation=function(t){if(null!=this.meshesPicked){if(this.meshesPicked.length>2)return"please select only two mesh";var e=c.FromMesh(this.meshPicked),i=c.FromMesh(this.meshesPicked[0]),s=void 0;if("subtract"===t)s=i.subtract(e);else if("intersect"===t)s=i.intersect(e);else{if("union"!==t)return"invalid operation";s=i.union(e)}var n=new Number(Date.now()).toString(),o=s.toMesh(n,this.meshesPicked[0].material,this.scene,!1);return this.switchEditControl(o),this.animateMesh(o),null}return"please select two mesh"},t.prototype.physTypes=function(){console.log("BoxImpostor "+k.BoxImpostor),console.log("SphereImpostor "+k.SphereImpostor),console.log("PlaneImpostor "+k.PlaneImpostor),console.log("CylinderImpostor "+k.CylinderImpostor),console.log("MeshImpostor "+k.MeshImpostor),console.log("ParticleImpostor "+k.ParticleImpostor),console.log("HeightmapImpostor "+k.HeightmapImpostor)},t.prototype.getMeshPickedPhyParms=function(){return this.meshPickedPhyParms},t.prototype.setMeshPickedPhyParms=function(t){this.meshPickedPhyParms=t},t.prototype.savePhyParms=function(){void 0===this.meshPicked.physicsImpostor||null===this.meshPicked.physicsImpostor?this.meshPickedPhyParms=null:(this.meshPickedPhyParms=new N,this.meshPickedPhyParms.type=this.meshPicked.physicsImpostor.type,this.meshPickedPhyParms.mass=this.meshPicked.physicsImpostor.getParam("mass"),this.meshPickedPhyParms.friction=this.meshPicked.physicsImpostor.getParam("friction"),this.meshPickedPhyParms.restitution=this.meshPicked.physicsImpostor.getParam("restitution"),this.meshPicked.physicsImpostor.dispose(),this.meshPicked.physicsImpostor=null)},t.prototype.restorePhyParms=function(){this.resetPhysics(),null!=this.meshPickedPhyParms&&(this.meshPicked.physicsImpostor=new k(this.meshPicked,this.meshPickedPhyParms.type),this.meshPicked.physicsImpostor.setParam("mass",this.meshPickedPhyParms.mass),this.meshPicked.physicsImpostor.setParam("friction",this.meshPickedPhyParms.friction),this.meshPicked.physicsImpostor.setParam("restitution",this.meshPickedPhyParms.restitution),this.meshPickedPhyParms=null)},t.prototype.testPhysics=function(t){this.resetPhysics(),this.didPhysTest=!0,this.savePos=this.meshPicked.position.clone(),this.saveRot=this.meshPicked.rotationQuaternion.clone(),this.meshPicked.physicsImpostor=new k(this.meshPicked,t.type),this.meshPicked.physicsImpostor.setParam("mass",t.mass),this.meshPicked.physicsImpostor.setParam("friction",t.friction),this.meshPicked.physicsImpostor.setParam("restitution",t.restitution)},t.prototype.resetPhysics=function(){this.didPhysTest&&(this.didPhysTest=!1,this.meshPicked.position.copyFrom(this.savePos),this.meshPicked.rotationQuaternion.copyFrom(this.saveRot),this.meshPicked.physicsImpostor.dispose(),this.meshPicked.physicsImpostor=null)},t.prototype.setMeshVisibility=function(t){this.meshPicked.visibility=t},t.prototype.getMeshVisibility=function(){return this.meshPicked.visibility},t.prototype.setMeshColor=function(t,e){if(this.meshPicked.material instanceof BABYLON.MultiMaterial)return"This is multimaterial. Not supported for now";if(!(this.meshPicked.material instanceof BABYLON.StandardMaterial))return"This is not a standard material. Not supported for now";var i=this.meshPicked.material,s=r.FromHexString(e);if("diffuse"===t)i.diffuseColor=s;else if("emissive"===t)i.emissiveColor=s;else if("specular"===t)i.specularColor=s;else{if("ambient"!==t)return"invalid color type ["+t+"]";i.ambientColor=s}return null},t.prototype.getMeshColor=function(t){if(this.meshPicked.material instanceof BABYLON.MultiMaterial)return"#000000";if(!(this.meshPicked.material instanceof BABYLON.StandardMaterial))return"#000000";var e=this.meshPicked.material;return"diffuse"===t?void 0!==e.diffuseColor?e.diffuseColor.toHexString():"#000000":"emissive"===t?void 0!==e.emissiveColor?e.emissiveColor.toHexString():"#000000":"specular"===t?void 0!==e.specularColor?e.specularColor.toHexString():"#000000":"ambient"===t?void 0!==e.ambientColor?e.ambientColor.toHexString():"#000000":(console.error("invalid color type ["+t+"]"),null)},t.prototype.getAttachedLight=function(){var t=this.meshPicked.getDescendants();if(0===t.length)return null;for(var e=null,i=0,s=t;i<s.length;i++){var n=s[i];if(n instanceof g){e=n;break}}if(null===e)return null;var o=new R;return o.diffuse=e.diffuse,o.specular=e.specular,o.range=e.range,o.radius=e.radius,o.intensity=e.intensity,e instanceof BABYLON.SpotLight&&(o.type="Spot",o.angle=e.angle,o.exponent=e.exponent),e instanceof BABYLON.PointLight&&(o.type="Point"),e instanceof BABYLON.DirectionalLight&&(o.type="Dir"),e instanceof BABYLON.HemisphericLight&&(o.type="Hemi",o.direction=e.direction,o.gndClr=e.groundColor),o},t.prototype.attachAlight=function(t){this.detachLight();var e=null,i=this.meshPicked.name+"-light";"Spot"===t.type?e=new BABYLON.SpotLight(i,I.Zero(),new I(0,-1,0),t.angle*Math.PI/180,t.exponent,this.scene):"Point"===t.type?e=new BABYLON.PointLight(i,I.Zero(),this.scene):"Dir"===t.type?e=new BABYLON.DirectionalLight(i,new I(0,-1,0),this.scene):"Hemi"===t.type&&(e=new BABYLON.HemisphericLight(i,t.direction,this.scene),e.groundColor=t.gndClr),null!==e&&(e.diffuse=t.diffuse,e.specular=t.specular,e.range=t.range,e.radius=t.radius,e.intensity=t.intensity,e.parent=this.meshPicked)},t.prototype.detachLight=function(){var t=this.meshPicked.getDescendants();if(0!==t.length){for(var e=null,i=0,s=t;i<s.length;i++){var n=s[i];if(n instanceof g){e=n;break}}null!==e&&(e.parent=null,e.setEnabled(!1),e.dispose())}},t.prototype.setTransOn=function(){this.editControl.setLocal(!this.spaceWorld),this.editControl.enableTranslation()},t.prototype.isTransOn=function(){return this.editControl.isTranslationEnabled()},t.prototype.setRotOn=function(){this.editControl.setLocal(!this.spaceWorld),this.editControl.enableRotation()},t.prototype.isRotOn=function(){return this.editControl.isRotationEnabled()},t.prototype.setScaleOn=function(){this.editControl.setLocal(!0),this.editControl.enableScaling()},t.prototype.isScaleOn=function(){return this.editControl.isScalingEnabled()},t.prototype.setFocusOnMesh=function(){this.isFocusOnAv&&(this.cc.stop(),this.saveAVcameraPos.copyFrom(this.mainCamera.position),this.isFocusOnAv=!1),this.focusOnMesh(this.meshPicked,25)},t.prototype.setSpace=function(t){return console.log("setSPace parm "+t),this.snapperOn?"Cannot switch space when snapper is on":("local"===t?this.setSpaceLocal(!0):this.setSpaceLocal(!1),null)},t.prototype.getSpace=function(){return this.isSpaceLocal()?"local":"world"},t.prototype.setSpaceLocal=function(t){return null==this.editControl||this.editControl.isScalingEnabled()||this.editControl.setLocal(t),this.spaceWorld=!t,null},t.prototype.isSpaceLocal=function(){return!this.spaceWorld},t.prototype.undo=function(){null!=this.editControl&&this.editControl.undo()},t.prototype.redo=function(){null!=this.editControl&&this.editControl.redo()},t.prototype.snapTrans=function(t){if(this.snapperOn)return"Cannot change snapping mode when snapper is on";this.snapTransOn=t,null!=this.editControl&&(this.snapTransOn?(this.editControl.setTransSnap(!0),this.editControl.setTransSnapValue(this.snapTransValue)):this.editControl.setTransSnap(!1))},t.prototype.isSnapTransOn=function(){return this.snapTransOn},t.prototype.setSnapTransValue=function(t){this.editControl.setTransSnapValue(t)},t.prototype.snapRot=function(t){if(this.snapperOn)return"Cannot change snapping mode when snapper is on";this.snapRotOn=t,null!=this.editControl&&(this.snapRotOn?(this.editControl.setRotSnap(!0),this.editControl.setRotSnapValue(this.snapRotValue)):this.editControl.setRotSnap(!1))},t.prototype.isSnapRotOn=function(){return this.snapRotOn},t.prototype.setSnapRotValue=function(t){var e=t*Math.PI/180;this.editControl.setRotSnapValue(e)},t.prototype.isSnapScaleOn=function(){return this.snapScaleOn},t.prototype.setSnapScaleValue=function(t){this.editControl.setScaleSnapValue(t)},t.prototype.snapScale=function(t){if(this.snapperOn)return"Cannot change snapping mode when snapper is on";this.snapScaleOn=t,null!=this.editControl&&(this.snapScaleOn?(this.editControl.setScaleSnap(!0),this.editControl.setScaleSnapValue(this.snapScaleValue)):this.editControl.setScaleSnap(!1))},t.prototype.snapper=function(t){!this.spaceWorld&&t&&(this.spaceWorld=!0),this.snapperOn=t,null!=this.editControl&&(this.snapperOn?this.setSnapperOn():this.setSnapperOff())},t.prototype.setSnapperOn=function(){this.editControl.setRotSnap(!0),this.editControl.setTransSnap(!0),this.editControl.setScaleSnap(!0),this.editControl.setRotSnapValue(this.snapRotValue),this.editControl.setTransSnapValue(this.snapTransValue),this.editControl.setScaleSnapValue(this.snapScaleValue),this.snapToGlobal()},t.prototype.setSnapperOff=function(){this.editControl.setRotSnap(!1),this.editControl.setTransSnap(!1),this.editControl.setScaleSnap(!1)},t.prototype.isSnapperOn=function(){return this.snapperOn},t.prototype.snapToGlobal=function(){if(this.isMeshSelected){var t=Math.round(this.meshPicked.position.x/this.snapTransValue)*this.snapTransValue,e=Math.round(this.meshPicked.position.y/this.snapTransValue)*this.snapTransValue,i=Math.round(this.meshPicked.position.z/this.snapTransValue)*this.snapTransValue;this.meshPicked.position=new I(t,e,i);var s=this.meshPicked.rotationQuaternion.toEulerAngles(),n=Math.round(s.x/this.snapRotValue)*this.snapRotValue,o=Math.round(s.y/this.snapRotValue)*this.snapRotValue,a=Math.round(s.z/this.snapRotValue)*this.snapRotValue;this.meshPicked.rotationQuaternion=S.RotationYawPitchRoll(o,n,a)}},t.prototype.getSoundFiles=function(){return this.assets.sounds},t.prototype.anyMeshSelected=function(){return this.isMeshSelected},t.prototype.getName=function(){return this.meshPicked.name},t.prototype.setName=function(t){this.meshPicked.name=t},t.prototype.getLocation=function(){return this.meshPicked.position},t.prototype.getRotation=function(){var t=this.meshPicked.rotationQuaternion.toEulerAngles(),e=180/Math.PI;return t.multiplyByFloats(e,e,e)},t.prototype.getScale=function(){return this.meshPicked.scaling},t.prototype.bakeTransforms=function(){var t=this.meshPicked.position.clone();this.meshPicked.position.copyFromFloats(0,0,0),this.meshPicked.bakeCurrentTransformIntoVertices(),this.meshPicked.position=t,this.meshPicked.computeWorldMatrix(!0)},t.prototype.getSkelName=function(){return null==this.meshPicked.skeleton?null:this.meshPicked.skeleton.name},t.prototype.getSkeleton=function(){return null==this.meshPicked.skeleton?null:this.meshPicked.skeleton},t.prototype.toggleSkelView=function(){if(null!=this.meshPicked.skeleton){var t=this.findSkelViewer(this.skelViewerArr,this.meshPicked);null===t?(t=new C(this.meshPicked.skeleton,this.meshPicked,this.scene),t.isEnabled=!0,this.skelViewerArr.push(t)):(this.delSkelViewer(this.skelViewerArr,t),t.dispose(),t=null)}},t.prototype.findSkelViewer=function(t,e){for(var i=0,s=t;i<s.length;i++){var n=s[i];if(n.mesh===e)return n}return null},t.prototype.delSkelViewer=function(t,e){var i=t.indexOf(e);i>=0&&t.splice(i,1)},t.prototype.animRest=function(){null!=this.meshPicked.skeleton&&(this.scene.stopAnimation(this.meshPicked.skeleton),this.meshPicked.skeleton.returnToRest())},t.prototype.createAnimRange=function(t,e,i){this.meshPicked.skeleton.deleteAnimationRange(t,!1),this.meshPicked.skeleton.createAnimationRange(t,e,i)},t.prototype.getAnimationRanges=function(){var t=this.meshPicked.skeleton;if(null!==t){return t.getAnimationRanges()}return null},t.prototype.printAnimCount=function(t){for(var e=t.bones,i=0,s=e;i<s.length;i++){var n=s[i];console.log(n.name+","+n.animations.length+" , "+n.animations[0].getHighestFrame()),console.log(n.animations[0])}},t.prototype.playAnimation=function(t,e,i){var s=this.meshPicked.skeleton;if(null!=s){var n=parseFloat(e);isNaN(n)&&(n=1),s.beginAnimation(t,i,n)}},t.prototype.stopAnimation=function(){null!=this.meshPicked.skeleton&&this.scene.stopAnimation(this.meshPicked.skeleton)},t.prototype.getSensorList=function(){return e.SNAManager.getSNAManager().getSensorList()},t.prototype.getActuatorList=function(){return e.SNAManager.getSNAManager().getActuatorList()},t.prototype.getSensorParms=function(t){return e.SNAManager.getSNAManager().getSensorParms(t)},t.prototype.getActuatorParms=function(t){return e.SNAManager.getSNAManager().getActuatorParms(t)},t.prototype.getSensors=function(){if(!this.isMeshSelected)return null;var t=this.meshPicked.sensors;return null==t&&(t=new Array),t},t.prototype.getActuators=function(){if(!this.isMeshSelected)return null;var t=this.meshPicked.actuators;return null==t&&(t=new Array),t},t.prototype.addSensorbyName=function(t){return this.isMeshSelected?e.SNAManager.getSNAManager().createSensorByName(t,this.meshPicked,null):null},t.prototype.addActuaorByName=function(t){return this.isMeshSelected?e.SNAManager.getSNAManager().createActuatorByName(t,this.meshPicked,null):null},t.prototype.add_sensor=function(t,i){if(!this.isMeshSelected)return"no mesh selected";if("Touch"!==t)return"No such sensor";new e.SensorTouch(this.meshPicked,i);return null},t.prototype.addActuator=function(t,i){if(!this.isMeshSelected)return"no mesh selected";if("Rotator"===t)new e.ActuatorRotator(this.meshPicked,i);else{if("Mover"!==t)return"No such actuator";new e.ActuatorMover(this.meshPicked,i)}return null},t.prototype.removeSensor=function(t){if(!this.isMeshSelected)return"no mesh selected";var e=this.meshPicked.sensors;if(null==e)return"no sensor found";var i=e[t];return null==i?"no sensor found":(i.dispose(),null)},t.prototype.removeActuator=function(t){if(!this.isMeshSelected)return"no mesh selected";var e=this.meshPicked.actuators;if(null==e)return"no actuator found";var i=e[t];return null==i?"no actuator found":(i.dispose(),null)},t.prototype.removeSensorActuator=function(t){t.dispose()},t.prototype.setSunPos=function(t){var e=Math.PI*(180-t)/180,i=-Math.cos(e),s=-Math.sin(e);this.sunDR.direction=new I(i,s,0)},t.prototype.getSunPos=function(){var t=this.sunDR.direction,e=t.x,i=t.y,s=Math.sqrt(e*e+i*i);return 180*Math.acos(e/s)/Math.PI},t.prototype.setLight=function(t){this.sun.intensity=t,this.sunDR.intensity=t,this.skybox.visibility=2*t},t.prototype.getLight=function(){return this.sun.intensity},t.prototype.setShade=function(t){var e=t;e=1-e,
this.sun.groundColor=new r(e,e,e)},t.prototype.getShade=function(){return 1-this.sun.groundColor.r},t.prototype.setFog=function(t){this.scene.fogDensity=t},t.prototype.getFog=function(){return this.scene.fogDensity},t.prototype.setFogColor=function(t){this.scene.fogColor=r.FromHexString(t)},t.prototype.getFogColor=function(){return this.scene.fogColor.toHexString()},t.prototype.setFov=function(t){var e=t;this.mainCamera.fov=3.14*e/180},t.prototype.getFov=function(){return 180*this.mainCamera.fov/3.14},t.prototype.setSky=function(t){var e=this.skybox.material;e.reflectionTexture.dispose();var i="vishva/assets/skyboxes/"+t+"/"+t;e.reflectionTexture=new l(i,this.scene),e.reflectionTexture.coordinatesMode=B.SKYBOX_MODE},t.prototype.getSky=function(){var t=this.skybox.material,e=t.reflectionTexture.name,i=e.lastIndexOf("/");return e.substring(i+1)},t.prototype.setGroundColor_old=function(t){var e=t,i=e[0]/255,s=e[1]/255,n=e[2]/255,o=new r(i,s,n);this.ground.material.diffuseColor=o},t.prototype.setGroundColor=function(t){this.ground.material.diffuseColor=r.FromHexString(t)},t.prototype.getGroundColor=function(){return this.ground.material.diffuseColor.toHexString()},t.prototype.getGroundColor_old=function(){var t=new Array(3),e=this.ground.material;return null!=e.diffuseColor?(t[0]=255*e.diffuseColor.r,t[1]=255*e.diffuseColor.g,t[2]=255*e.diffuseColor.b,t):null},t.prototype.toggleDebug=function(){this.debugVisible?this.scene.debugLayer.hide():this.scene.debugLayer.show(),this.debugVisible=!this.debugVisible},t.prototype.saveAsset=function(){if(!this.isMeshSelected)return null;var t=this.meshPicked.clone(this.meshPicked.name,null);t.position=I.Zero(),t.rotation=I.Zero();var e=A.SerializeMesh(t,!1);t.dispose();var i=JSON.stringify(e),s=new File([i],"AssetFile.babylon");return URL.createObjectURL(s)},t.prototype.saveWorld=function(){if(null!=this.editControl)return alert("cannot save during edit"),null;this.removeInstancesFromShadow(),this.renameMeshIds(),this.cleanupSkels(),this.resetSkels(this.scene),this.cleanupMats(),this.renameWorldTextures();var t=new e.VishvaSerialized;t.settings.cameraCollision=this.cameraCollision,t.settings.autoEditMenu=this.autoEditMenu,t.guiSettings=this.vishvaGUI.getSettings(),t.misc.activeCameraTarget=this.mainCamera.target,t.snas=e.SNAManager.getSNAManager().serializeSnAs(this.scene);var i=A.Serialize(this.scene);this.changeSoundUrl(i),i.VishvaSerialized=t;var s=JSON.stringify(i),n=new File([s],"WorldFile.babylon");return this.addInstancesToShadow(),URL.createObjectURL(n)},t.prototype.removeInstancesFromShadow=function(){for(var t=this.scene.meshes,e=0,i=t;e<i.length;e++){var s=i[e];if(null!=s&&s instanceof BABYLON.InstancedMesh){var n=this.shadowGenerator.getShadowMap().renderList,o=n.indexOf(s);o>=0&&n.splice(o,1)}}},t.prototype.addInstancesToShadow=function(){for(var t=0,e=this.scene.meshes;t<e.length;t++){var i=e[t];null!=i&&i instanceof BABYLON.InstancedMesh&&this.shadowGenerator.getShadowMap().renderList.push(i)}},t.prototype.renameMeshIds=function(){for(var t=0,e=0,i=this.scene.meshes;e<i.length;e++){i[e].id=new Number(t).toString(),t++}},t.prototype.resetSkels=function(t){for(var e=0,i=0,s=t.skeletons;i<s.length;i++){var n=s[i];n.id=new Number(e).toString(),e++,n.returnToRest()}},t.prototype.renameWorldTextures=function(){var t=this.scene.materials;this.renameWorldMaterials(t);for(var e=this.scene.multiMaterials,i=0,s=e;i<s.length;i++){var n=s[i];this.renameWorldMaterials(n.subMaterials)}},t.prototype.renameWorldMaterials=function(t){for(var e,i=0,s=t;i<s.length;i++){var n=s[i];null!=n&&n instanceof BABYLON.StandardMaterial&&(e=n,this.rename(e.diffuseTexture),this.rename(e.reflectionTexture),this.rename(e.opacityTexture),this.rename(e.specularTexture),this.rename(e.bumpTexture),this.rename(e.ambientTexture))}},t.prototype.rename=function(t){null!=t&&".."!==t.name.substring(0,2)&&(t.name=this.RELATIVE_ASSET_LOCATION+t.name)},t.prototype.changeSoundUrl=function(t){var e=t.sounds;if(null!=e)for(var i=e,s=0,n=i;s<n.length;s++){var o=n[s];o.url=this.SOUND_ASSET_LOCATION+o.url}},t.prototype.cleanupMats=function(){for(var t=this.scene.meshes,e=new Array,i=new Array,s=0,n=t;s<n.length;s++){var o=n[s];if(null!=o.material)if(null!=o.material&&o.material instanceof BABYLON.MultiMaterial){var a=o.material;i.push(a);for(var r=a.subMaterials,h=0;h<r.length;h++){var l=r[h];e.push(l)}}else e.push(o.material)}for(var c=this.scene.materials,u=c.length,p=u-1;p>=0;p--)-1===e.indexOf(c[0|p])&&c[0|p].dispose();var d=this.scene.multiMaterials;u=d.length;for(var p=u-1;p>=0;p--)-1===i.indexOf(d[0|p])&&d[0|p].dispose()},t.prototype.cleanupSkels=function(){for(var t=this.scene.meshes,e=new Array,i=0,s=t;i<s.length;i++){var n=s[i];null!=n.skeleton&&e.push(n.skeleton)}for(var o=this.scene.skeletons,a=o.length,r=a-1;r>=0;r--)-1===e.indexOf(o[0|r])&&o[0|r].dispose()},t.prototype.loadAssetFile=function(t){var e=this,i=t.name.split(".")[0];P.ImportMesh("","vishva/assets/"+i+"/",t.name,this.scene,function(t,i,s){return e.onMeshLoaded(t,i,s)})},t.prototype.loadAsset=function(t,e){var i=this;this.assetType=t,this.file=e,P.ImportMesh("","vishva/assets/"+t+"/"+e+"/",e+".babylon",this.scene,function(t,e,s){return i.onMeshLoaded(t,e,s)})},t.prototype.onMeshLoaded=function(t,e,i){for(var s=this.getBoundingRadius(t),n=0,o=t;n<o.length;n++){var a=o[n];a.isPickable=!0,a.checkCollisions=!0;var r=new I(0,0,-(s+2)),h=I.TransformCoordinates(r,this.avatar.getWorldMatrix());if(a.position.addInPlace(h),this.shadowGenerator.getShadowMap().renderList.push(a),null!=a.material&&a.material instanceof BABYLON.MultiMaterial)for(var l=a.material,c=l.subMaterials,u=0,p=c;u<p.length;u++){var d=p[u];a.material.backFaceCulling=!1,a.material.alpha=1,null!=d&&d instanceof BABYLON.StandardMaterial&&this.renameAssetTextures(d)}else{a.material.backFaceCulling=!1,a.material.alpha=1;var g=a.material;this.renameAssetTextures(g)}null!=a.skeleton&&this.fixAnimationRanges(a.skeleton)}if(t.length>0){var m=t[t.length-1];this.isMeshSelected?this.switchEditControl(m):this.selectForEdit(m),this.animateMesh(m)}},t.prototype.renameAssetTextures=function(t){this.renameAssetTexture(t.diffuseTexture),this.renameAssetTexture(t.reflectionTexture),this.renameAssetTexture(t.opacityTexture),this.renameAssetTexture(t.specularTexture),this.renameAssetTexture(t.bumpTexture)},t.prototype.renameAssetTexture=function(t){if(null!=t){var e=t.name;0!==e.indexOf("vishva/")&&0!==e.indexOf("../")&&(t.name="vishva/assets/"+this.assetType+"/"+this.file+"/"+e)}},t.prototype.getBoundingRadius=function(t){for(var e=0,i=0;i<t.length;i++){var s=t[i],n=s.getBoundingInfo(),o=n.boundingSphere.radiusWorld+s.position.length();e<o&&(e=o)}return e},t.prototype.loadWorldFile=function(t){var e=this;this.sceneFolderName=t.name.split(".")[0];var i=new FileReader;i.onload=function(t){return e.onSceneFileRead(t)},i.readAsText(t)},t.prototype.onSceneFileRead=function(t){var e=this;return this.sceneData="data:"+t.target.result,this.engine.stopRenderLoop(),this.scene.onDispose=function(){return e.onSceneDispose()},this.scene.dispose(),null},t.prototype.onSceneDispose=function(){var t=this;this.scene=null,this.avatarSkeleton=null,this.avatar=null,P.Load("worlds/"+this.sceneFolderName+"/",this.sceneData,this.engine,function(e){return t.onSceneLoaded(e)})},t.prototype.createWater=function(){console.log("creating water");var t=v.CreateGround("waterMesh",512,512,32,this.scene,!1),e=new E("water",this.scene);e.backFaceCulling=!0,e.bumpTexture=new B(this.waterTexture,this.scene),e.bumpTexture.name=this.RELATIVE_ASSET_LOCATION+e.bumpTexture.name,e.windForce=-5,e.waveHeight=.5,e.colorBlendFactor=0,e.bumpHeight=.1,e.waveLength=.1,e.addToRenderList(this.skybox),t.material=e},t.prototype.addWater=function(){if(!this.isMeshSelected)return"no mesh selected";var t=new E("water",this.scene);t.bumpTexture=new B(this.waterTexture,this.scene),t.windForce=.1,t.waveHeight=.1,t.colorBlendFactor=0,t.bumpHeight=0,t.waveLength=0,t.addToRenderList(this.skybox),this.meshPicked.material=t},t.prototype.switchAvatar=function(){return this.isMeshSelected?this.isAvatar(this.meshPicked)?(this.cc.stop(),e.SNAManager.getSNAManager().enableSnAs(this.avatar),this.avatar.rotationQuaternion=S.RotationYawPitchRoll(this.avatar.rotation.y,this.avatar.rotation.x,this.avatar.rotation.z),this.avatar.isPickable=!0,M.RemoveTagsFrom(this.avatar,"Vishva.avatar"),null!=this.avatarSkeleton&&(M.RemoveTagsFrom(this.avatarSkeleton,"Vishva.skeleton"),this.avatarSkeleton.name=""),this.avatar=this.meshPicked,this.avatarSkeleton=this.avatar.skeleton,M.AddTagsTo(this.avatar,"Vishva.avatar"),null!=this.avatarSkeleton&&(M.AddTagsTo(this.avatarSkeleton,"Vishva.skeleton"),this.avatarSkeleton.name="Vishva.skeleton",this.checkAnimRange(this.avatarSkeleton),this.avatarSkeleton.enableBlending(.1)),this.avatar.checkCollisions=!0,this.avatar.ellipsoid=new I(.5,1,.5),this.avatar.ellipsoidOffset=new I(0,2,0),this.avatar.isPickable=!1,this.avatar.rotation=this.avatar.rotationQuaternion.toEulerAngles(),this.avatar.rotationQuaternion=null,this.saveAVcameraPos=this.mainCamera.position,this.isFocusOnAv=!0,this.removeEditControl(),e.SNAManager.getSNAManager().disableSnAs(this.avatar),this.cc.setAvatar(this.avatar),this.cc.setAvatarSkeleton(this.avatarSkeleton),this.cc.start(),null):"cannot use this as avatar":"no mesh selected"},t.prototype.isAvatar=function(t){return null!=t.skeleton},t.prototype.checkAnimRange=function(t){for(var e=0,i=this.anims;e<i.length;e++){var s=i[e];null!=t.getAnimationRange(s.name)?s.exist=!0:(console.log(s.name+" not found"),s.exist=!1)}},t.prototype.setAvatar=function(t,e){for(var i,s=0;s<e.length;s++){if(i=e[s],i.id===t){var n,o;null!=this.avatar?(n=this.avatar.rotation,o=this.avatar.position):(n=new I(0,Math.PI,0),o=new I(0,0,0)),this.avatar=i,this.avatar.rotation=n,this.avatar.position=o,this.avatar.visibility=1,this.avatar.skeleton=this.avatarSkeleton,this.avatar.checkCollisions=!0,this.avatar.ellipsoid=new I(.5,1,.5),this.avatar.ellipsoidOffset=new I(0,2,0),this.avatar.isPickable=!1}else i.skeleton=null,i.visibility=0,i.checkCollisions=!1}},t.prototype.createGround=function(t){var e=new T("groundMat",t);e.diffuseTexture=new B(this.groundTexture,t),e.diffuseTexture.uScale=6,e.diffuseTexture.vScale=6,e.diffuseColor=new r(.9,.6,.4),e.specularColor=new r(0,0,0);var i=v.CreateGround("ground",256,256,1,t);return i.material=e,i.checkCollisions=!0,i.isPickable=!1,M.AddTagsTo(i,"Vishva.ground Vishva.internal"),i.freezeWorldMatrix(),i.receiveShadows=!0,this.enablePhysics&&(i.physicsImpostor=new BABYLON.PhysicsImpostor(i,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:.1},this.scene)),i},t.prototype.createGround_htmap=function(t){var e=this,i=this.createGroundMaterial(t);f.CreateGroundFromHeightMap("ground",this.groundHeightMap,{width:10240,height:10240,minHeight:0,maxHeight:1e3,subdivisions:32,onReady:function(t){console.log("ground created"),t.material=i,t.checkCollisions=!0,t.isPickable=!1,M.AddTagsTo(t,"Vishva.ground Vishva.internal"),t.receiveShadows=!0,e.enablePhysics&&(t.physicsImpostor=new BABYLON.PhysicsImpostor(t,BABYLON.PhysicsImpostor.HeightmapImpostor,{mass:0,restitution:.1},e.scene)),t.freezeWorldMatrix(),e.ground=t}},t)},t.prototype.createGroundMaterial=function(t){var e=new T("groundMat",t);return e.diffuseTexture=new B(this.groundTexture,t),e.diffuseTexture.uScale=100,e.diffuseTexture.vScale=100,e.diffuseColor=new r(.9,.6,.4),e.specularColor=new r(0,0,0),e},t.prototype.createSkyBox=function(t){var e=new T("skyBox",t);e.backFaceCulling=!1,e.disableLighting=!0,e.diffuseColor=new r(0,0,0),e.specularColor=new r(0,0,0),e.reflectionTexture=new l(this.skyboxTextures,t),e.reflectionTexture.coordinatesMode=B.SKYBOX_MODE;var i=v.CreateBox("skyBox",1e4,t);return i.material=e,i.infiniteDistance=!0,i.renderingGroupId=0,i.isPickable=!1,M.AddTagsTo(i,"Vishva.sky Vishva.internal"),i},t.prototype.toggleSnow=function(){null===this.snowPart&&(this.snowPart=this.createSnowPart()),this.snowing?this.snowPart.stop():(this.snowPart.start(),this.raining&&(this.rainPart.stop(),this.raining=!1)),this.snowing=!this.snowing},t.prototype.createSnowPart=function(){var t=new y("snow",1e3,this.scene);return t.particleTexture=new BABYLON.Texture(this.snowTexture,this.scene),t.emitter=new I(0,10,0),t.maxEmitBox=new I(100,10,100),t.minEmitBox=new I(-100,10,-100),t.emitRate=1e3,t.updateSpeed=.005,t.minLifeTime=1,t.maxLifeTime=5,t.minSize=.1,t.maxSize=.5,t.color1=new BABYLON.Color4(1,1,1,1),t.color2=new BABYLON.Color4(1,1,1,1),t.colorDead=new BABYLON.Color4(0,0,0,0),t.gravity=new BABYLON.Vector3(0,-9.81,0),t},t.prototype.toggleRain=function(){null===this.rainPart&&(this.rainPart=this.createRainPart()),this.raining?this.rainPart.stop():(this.rainPart.start(),this.snowing&&(this.snowPart.stop(),this.snowing=!1)),this.raining=!this.raining},t.prototype.createRainPart=function(){var t=new y("rain",4e3,this.scene);return t.particleTexture=new BABYLON.Texture(this.rainTexture,this.scene),t.emitter=new I(0,40,0),t.maxEmitBox=new I(100,40,100),t.minEmitBox=new I(-100,40,-100),t.emitRate=1e3,t.updateSpeed=.02,t.minLifeTime=5,t.maxLifeTime=10,t.minSize=.1,t.maxSize=.8,t.color1=new BABYLON.Color4(1,1,1,.5),t.color2=new BABYLON.Color4(0,0,1,1),t.colorDead=new BABYLON.Color4(0,0,0,0),t.gravity=new BABYLON.Vector3(0,-9.81,0),t},t.prototype.createCamera=function(t,e){var i=new o("v.c-camera",1,1.4,4,new I(0,1e3,0),t);return this.setCameraSettings(i),i.attachControl(e,!0),null!==this.avatar&&void 0!==this.avatar&&(i.target=new I(this.avatar.position.x,this.avatar.position.y+1.5,this.avatar.position.z),i.alpha=-this.avatar.rotation.y-4.69),i.checkCollisions=this.cameraCollision,i.collisionRadius=new I(.5,.5,.5),M.AddTagsTo(i,"Vishva.camera"),i},t.prototype.loadAvatar=function(){var t=this;P.ImportMesh("",this.avatarFolder,this.avatarFile,this.scene,function(e,i,s){return t.onAvatarLoaded(e,i,s)})},t.prototype.onAvatarLoaded=function(t,e,i){this.avatar=t[0],this.shadowGenerator.getShadowMap().renderList.push(this.avatar);for(var n=t.length,o=1;o<n;o++)t[o].checkCollisions=!1,t[o].dispose();this.avatarSkeleton=i[0],n=i.length;for(var o=1;o<n;o++)i[o].dispose();this.fixAnimationRanges(this.avatarSkeleton),this.avatar.skeleton=this.avatarSkeleton,this.checkAnimRange(this.avatarSkeleton),this.avatarSkeleton.enableBlending(.1),this.avatar.position=new I(0,1020,0),this.avatar.checkCollisions=!0,this.avatar.ellipsoid=new I(.5,1,.5),this.avatar.ellipsoidOffset=new I(0,2,0),this.avatar.isPickable=!1,M.AddTagsTo(this.avatar,"Vishva.avatar"),M.AddTagsTo(this.avatarSkeleton,"Vishva.skeleton"),this.avatarSkeleton.name="Vishva.skeleton",this.mainCamera.alpha=-this.avatar.rotation.y-4.69;var a=this.avatar.material;if(null!=a.diffuseTexture){var h=a.diffuseTexture.name;a.diffuseTexture.name=this.avatarFolder+h,a.backFaceCulling=!0,a.ambientColor=new r(0,0,0)}this.cc=new s(this.avatar,this.avatarSkeleton,this.anims,this.mainCamera,this.scene),this.cc.start()},t.prototype.setAnimationRange=function(t){for(var e=0;e<this.anims.length;e++){var i=this.anims[e];t.createAnimationRange(i.name,i.s,i.e)}},t.prototype.fixAnimationRanges=function(t){for(var e=t.getAnimationRanges,i=e.call(t),s=0,n=i;s<n.length;s++){n[s].from++}},t.prototype.setCameraSettings=function(t){t.lowerRadiusLimit=.25,t.keysLeft=[],t.keysRight=[],t.keysUp=[],t.keysDown=[],t.panningInertia=.1,t.inertia=.1,t.panningSensibility=250,t.angularSensibilityX=250,t.angularSensibilityY=250},t.prototype.backfaceCulling=function(t){var e;for(e=0;e<t.length;++e)t[e].backFaceCulling=!1},t.prototype.disableKeys=function(){this.keysDisabled=!0,this.cc.stop()},t.prototype.enableKeys=function(){this.keysDisabled=!1,this.isFocusOnAv&&this.cc.start()},t.prototype.enableCameraCollision=function(t){this.cameraCollision=t,this.mainCamera.checkCollisions=t},t.prototype.isCameraCollisionOn=function(){return this.cameraCollision},t.prototype.enableAutoEditMenu=function(t){this.autoEditMenu=t},t.prototype.isAutoEditMenuOn=function(){return this.autoEditMenu},t}();e.Vishva=O;var D=function(){function t(){this.up=!1,this.down=!1,this.right=!1,this.left=!1,this.stepRight=!1,this.stepLeft=!1,this.jump=!1,this.shift=!1,this.trans=!1,this.rot=!1,this.scale=!1,this.esc=!1,this.ctl=!1,this.focus=!1}return t}();e.Key=D;var L=function(){function t(t,e,i,s){this.exist=!1,this.s=0,this.e=0,this.r=0,this.name=t,this.s=e,this.e=i,this.r=s}return t}();e.AnimData=L;var N=function(){function t(){}return t}();e.PhysicsParm=N;var R=function(){function t(){this.type="Spot",this.diffuse=r.White(),this.specular=r.White(),this.intensity=1,this.range=5,this.radius=5,this.angle=45,this.exponent=1,this.gndClr=r.White(),this.direction=I.Zero()}return t}();e.LightParm=R}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){var e=BABYLON.Vector3,i=function(){function t(){this.settings=new s,this.misc=new n}return t}();t.VishvaSerialized=i;var s=function(){function t(){this.cameraCollision=!0,this.autoEditMenu=!1}return t}();t.SettingsSerialized=s;var n=function(){function t(){this.activeCameraTarget=e.Zero()}return t}();t.MiscSerialized=n}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));