var BABYLON;(function(BABYLON){var DynamicTerrain=function(){function DynamicTerrain(name,options,scene){var _this=this;this._subToleranceX=1;this._subToleranceZ=1;this._LODLimits=[];this._initialLOD=1;this._LODValue=1;this._cameraLODCorrection=0;this._oldCorrection=0;this._deltaX=0;this._deltaZ=0;this._signX=0;this._signZ=0;this._deltaSubX=0;this._deltaSubZ=0;this._mapShiftX=0;this._mapShiftZ=0;this._mapFlgtNb=0;this._needsUpdate=false;this._updateLOD=false;this._updateForced=false;this._refreshEveryFrame=false;this._useCustomVertexFunction=false;this._computeNormals=false;this._datamap=false;this._uvmap=false;this._colormap=false;this._vertex={position:BABYLON.Vector3.Zero(),uvs:BABYLON.Vector2.Zero(),color:new BABYLON.Color4(1,1,1,1),lodX:1,lodZ:1,worldPosition:BABYLON.Vector3.Zero(),mapIndex:0};this._averageSubSizeX=0;this._averageSubSizeZ=0;this._terrainSizeX=0;this._terrainSizeZ=0;this._terrainHalfSizeX=0;this._terrainHalfSizeZ=0;this._centerWorld=BABYLON.Vector3.Zero();this._centerLocal=BABYLON.Vector3.Zero();this._mapSizeX=0;this._mapSizeZ=0;this._isAlwaysVisible=false;this._precomputeNormalsFromMap=false;this._bbMin=BABYLON.Vector3.Zero();this._bbMax=BABYLON.Vector3.Zero();this.name=name;this._terrainSub=options.terrainSub||60;this._mapData=options.mapData;this._terrainIdx=this._terrainSub+1;this._mapSubX=options.mapSubX||this._terrainIdx;this._mapSubZ=options.mapSubZ||this._terrainIdx;this._mapUVs=options.mapUVs;this._mapColors=options.mapColors;this._scene=scene;this._terrainCamera=options.camera||scene.activeCamera;this._datamap=this._mapData?true:false;this._uvmap=this._mapUVs?true:false;this._colormap=this._mapColors?true:false;this._mapData=this._datamap?this._mapData:new Float32Array(this._terrainIdx*this._terrainIdx*3);this._mapUVs=this._uvmap?this._mapUVs:new Float32Array(this._terrainIdx*this._terrainIdx*2);if(this._datamap){this._mapNormals=options.mapNormals||new Float32Array(this._mapSubX*this._mapSubZ*3)}else{this._mapNormals=new Float32Array(this._terrainIdx*this._terrainIdx*3)}var index=0;var posIndex=0;var colIndex=0;var uvIndex=0;var color;var uv;var terIndex=0;var y=0;var terrainPath;var u=0;var v=0;var lg=this._terrainIdx+1;var terrainData=[];var terrainColor=[];var terrainUV=[];for(var j=0;j<=this._terrainSub;j++){terrainPath=[];for(var i=0;i<=this._terrainSub;i++){index=this._mod(j*3,this._mapSubZ)*this._mapSubX+this._mod(i*3,this._mapSubX);posIndex=index*3;colIndex=index*3;uvIndex=index*2;terIndex=j*this._terrainIdx+i;if(this._datamap){y=this._mapData[posIndex+1]}else{y=0;this._mapData[3*terIndex]=i;this._mapData[3*terIndex+1]=y;this._mapData[3*terIndex+2]=j}terrainPath.push(new BABYLON.Vector3(i,y,j));if(this._colormap){color=new BABYLON.Color4(this._mapColors[colIndex],this._mapColors[colIndex+1],this._mapColors[colIndex+2],1)}else{color=new BABYLON.Color4(1,1,1,1)}terrainColor.push(color);if(this._uvmap){uv=new BABYLON.Vector2(this._mapUVs[uvIndex],this._mapUVs[uvIndex+1])}else{u=1-Math.abs(1-2*i/lg);v=1-Math.abs(1-2*j/lg);this._mapUVs[2*terIndex]=u;this._mapUVs[2*terIndex+1]=v;uv=new BABYLON.Vector2(u,v)}terrainUV.push(uv)}terrainData.push(terrainPath)}this._mapSizeX=Math.abs(this._mapData[(this._mapSubX-1)*3]-this._mapData[0]);this._mapSizeZ=Math.abs(this._mapData[(this._mapSubZ-1)*this._mapSubX*3+2]-this._mapData[2]);this._averageSubSizeX=this._mapSizeX/this._mapSubX;this._averageSubSizeZ=this._mapSizeZ/this._mapSubZ;var ribbonOptions={pathArray:terrainData,sideOrientation:options.invertSide?BABYLON.Mesh.FRONTSIDE:BABYLON.Mesh.BACKSIDE,colors:terrainColor,uvs:terrainUV,updatable:true};this._terrain=BABYLON.MeshBuilder.CreateRibbon("terrain",ribbonOptions,this._scene);this._indices=this._terrain.getIndices();this._positions=this._terrain.getVerticesData(BABYLON.VertexBuffer.PositionKind);this._normals=this._terrain.getVerticesData(BABYLON.VertexBuffer.NormalKind);this._uvs=this._terrain.getVerticesData(BABYLON.VertexBuffer.UVKind);this._colors=this._terrain.getVerticesData(BABYLON.VertexBuffer.ColorKind);this.computeNormalsFromMap();this.update(true);this._terrain.position.x=this._terrainCamera.globalPosition.x-this._terrainHalfSizeX;this._terrain.position.z=this._terrainCamera.globalPosition.z-this._terrainHalfSizeZ;var deltaNbSubX=(this._terrain.position.x-this._mapData[0])/this._averageSubSizeX;var deltaNbSubZ=(this._terrain.position.z-this._mapData[2])/this._averageSubSizeZ;this._deltaSubX=deltaNbSubX>0?Math.floor(deltaNbSubX):Math.ceil(deltaNbSubX);this._deltaSubZ=deltaNbSubZ>0?Math.floor(deltaNbSubZ):Math.ceil(deltaNbSubZ);this._scene.registerBeforeRender(function(){_this.beforeUpdate(_this._refreshEveryFrame);_this.update(_this._refreshEveryFrame);_this.afterUpdate(_this._refreshEveryFrame)});this.update(true)}DynamicTerrain.prototype.update=function(force){this._needsUpdate=false;this._updateLOD=false;this._updateForced=force?true:false;this._deltaX=this._terrainHalfSizeX+this._terrain.position.x-this._terrainCamera.globalPosition.x;this._deltaZ=this._terrainHalfSizeZ+this._terrain.position.z-this._terrainCamera.globalPosition.z;this._oldCorrection=this._cameraLODCorrection;this._cameraLODCorrection=this.updateCameraLOD(this._terrainCamera)|0;this._updateLOD=this._oldCorrection!=this._cameraLODCorrection;this._LODValue=this._initialLOD+this._cameraLODCorrection;this._LODValue=this._LODValue>0?this._LODValue:1;this._mapShiftX=this._averageSubSizeX*this._subToleranceX*this._LODValue;this._mapShiftZ=this._averageSubSizeZ*this._subToleranceZ*this._LODValue;if(Math.abs(this._deltaX)>this._mapShiftX){this._signX=this._deltaX>0?-1:1;this._mapFlgtNb=Math.abs(this._deltaX/this._mapShiftX)|0;this._terrain.position.x+=this._mapShiftX*this._signX*this._mapFlgtNb;this._deltaSubX+=this._subToleranceX*this._signX*this._LODValue*this._mapFlgtNb;this._needsUpdate=true}if(Math.abs(this._deltaZ)>this._mapShiftZ){this._signZ=this._deltaZ>0?-1:1;this._mapFlgtNb=Math.abs(this._deltaZ/this._mapShiftZ)|0;this._terrain.position.z+=this._mapShiftZ*this._signZ*this._mapFlgtNb;this._deltaSubZ+=this._subToleranceZ*this._signZ*this._LODValue*this._mapFlgtNb;this._needsUpdate=true}if(this._needsUpdate||this._updateLOD||this._updateForced){this._deltaSubX=this._mod(this._deltaSubX,this._mapSubX);this._deltaSubZ=this._mod(this._deltaSubZ,this._mapSubZ);this._updateTerrain()}this._updateForced=false;this._updateLOD=false;this._centerLocal.x=this._terrainHalfSizeX;this._centerLocal.y=this._terrain.position.y;this._centerLocal.z=this._terrainHalfSizeZ;this._centerWorld.x=this._terrain.position.x+this._terrainHalfSizeX;this._centerWorld.y=this._terrain.position.y;this._centerWorld.z=this._terrain.position.z+this._terrainHalfSizeZ;return this};DynamicTerrain.prototype._updateTerrain=function(){var stepJ=0|0;var stepI=0|0;var LODLimitDown=0|0;var LODLimitUp=0|0;var LODValue=this._LODValue;var lodI=LODValue;var lodJ=LODValue;var l=0|0;var index=0|0;var posIndex=0|0;var colIndex=0|0;var uvIndex=0|0;var terIndex=0|0;var ribbonInd=0|0;var ribbonPosInd=0|0;var ribbonUVInd=0|0;var ribbonColInd=0|0;var ribbonPosInd1=0|0;var ribbonPosInd2=0|0;var ribbonPosInd3=0|0;if(this._updateLOD||this._updateForced){this.updateTerrainSize()}BABYLON.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this._bbMin);BABYLON.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this._bbMax);for(var j=0|0;j<=this._terrainSub;j++){LODValue=this._LODValue;for(l=0;l<this._LODLimits.length;l++){LODLimitDown=this._LODLimits[l];LODLimitUp=this._terrainSub-LODLimitDown-1;if(j<LODLimitDown||j>LODLimitUp){LODValue=l+1+this._LODValue}lodJ=LODValue}for(var i=0|0;i<=this._terrainSub;i++){LODValue=this._LODValue;for(l=0;l<this._LODLimits.length;l++){LODLimitDown=this._LODLimits[l];LODLimitUp=this._terrainSub-LODLimitDown-1;if(i<LODLimitDown||i>LODLimitUp){LODValue=l+1+this._LODValue}lodI=LODValue}index=this._mod(this._deltaSubZ+stepJ,this._mapSubZ)*this._mapSubX+this._mod(this._deltaSubX+stepI,this._mapSubX);terIndex=this._mod(this._deltaSubZ+stepJ,this._terrainIdx)*this._terrainIdx+this._mod(this._deltaSubX+stepI,this._terrainIdx);if(this._datamap){posIndex=3*index}else{posIndex=3*terIndex}if(this._uvmap){uvIndex=2*index}else{uvIndex=2*terIndex}if(this._colormap){colIndex=3*index}else{colIndex=3*terIndex}ribbonPosInd=3*ribbonInd;ribbonColInd=4*ribbonInd;ribbonUVInd=2*ribbonInd;ribbonPosInd1=ribbonPosInd;ribbonPosInd2=ribbonPosInd+1;ribbonPosInd3=ribbonPosInd+2;ribbonInd+=1;this._positions[ribbonPosInd1]=this._averageSubSizeX*stepI;this._positions[ribbonPosInd2]=this._mapData[posIndex+1];this._positions[ribbonPosInd3]=this._averageSubSizeZ*stepJ;if(!this._computeNormals){this._normals[ribbonPosInd1]=this._mapNormals[posIndex];this._normals[ribbonPosInd2]=this._mapNormals[posIndex+1];this._normals[ribbonPosInd3]=this._mapNormals[posIndex+2]}if(this._positions[ribbonPosInd1]<this._bbMin.x){this._bbMin.x=this._positions[ribbonPosInd1]}if(this._positions[ribbonPosInd1]>this._bbMax.x){this._bbMax.x=this._positions[ribbonPosInd1]}if(this._positions[ribbonPosInd2]<this._bbMin.y){this._bbMin.y=this._positions[ribbonPosInd2]}if(this._positions[ribbonPosInd2]>this._bbMax.y){this._bbMax.y=this._positions[ribbonPosInd2]}if(this._positions[ribbonPosInd3]<this._bbMin.z){this._bbMin.z=this._positions[ribbonPosInd3]}if(this._positions[ribbonPosInd3]>this._bbMax.z){this._bbMax.z=this._positions[ribbonPosInd3]}var terrainIndex=j*this._terrainIdx+i;if(this._colormap){this._colors[ribbonColInd]=this._mapColors[colIndex];this._colors[ribbonColInd+1]=this._mapColors[colIndex+1];this._colors[ribbonColInd+2]=this._mapColors[colIndex+2]}this._uvs[ribbonUVInd]=this._mapUVs[uvIndex];this._uvs[ribbonUVInd+1]=this._mapUVs[uvIndex+1];if(this._useCustomVertexFunction){this._vertex.position.copyFromFloats(this._positions[ribbonPosInd1],this._positions[ribbonPosInd2],this._positions[ribbonPosInd3]);this._vertex.worldPosition.x=this._mapData[posIndex];this._vertex.worldPosition.y=this._vertex.position.y;this._vertex.worldPosition.z=this._mapData[posIndex+2];this._vertex.lodX=lodI;this._vertex.lodZ=lodJ;this._vertex.color.r=this._colors[ribbonColInd];this._vertex.color.g=this._colors[ribbonColInd+1];this._vertex.color.b=this._colors[ribbonColInd+2];this._vertex.color.a=this._colors[ribbonColInd+3];this._vertex.uvs.x=this._uvs[ribbonUVInd];this._vertex.uvs.y=this._uvs[ribbonUVInd+1];this._vertex.mapIndex=index;this.updateVertex(this._vertex,i,j);this._colors[ribbonColInd]=this._vertex.color.r;this._colors[ribbonColInd+1]=this._vertex.color.g;this._colors[ribbonColInd+2]=this._vertex.color.b;this._colors[ribbonColInd+3]=this._vertex.color.a;this._uvs[ribbonUVInd]=this._vertex.uvs.x;this._uvs[ribbonUVInd+1]=this._vertex.uvs.y;this._positions[ribbonPosInd1]=this._vertex.position.x;this._positions[ribbonPosInd2]=this._vertex.position.y;this._positions[ribbonPosInd3]=this._vertex.position.z}stepI+=lodI}stepI=0;stepJ+=lodJ}this._terrain.updateVerticesData(BABYLON.VertexBuffer.PositionKind,this._positions,false,false);if(this._computeNormals){BABYLON.VertexData.ComputeNormals(this._positions,this._indices,this._normals)}this._terrain.updateVerticesData(BABYLON.VertexBuffer.NormalKind,this._normals,false,false);this._terrain.updateVerticesData(BABYLON.VertexBuffer.UVKind,this._uvs,false,false);this._terrain.updateVerticesData(BABYLON.VertexBuffer.ColorKind,this._colors,false,false);this._terrain._boundingInfo=new BABYLON.BoundingInfo(this._bbMin,this._bbMax);this._terrain._boundingInfo.update(this._terrain._worldMatrix)};DynamicTerrain.prototype._mod=function(a,b){return(a%b+b)%b};DynamicTerrain.prototype.updateTerrainSize=function(){var remainder=this._terrainSub;var nb=0|0;var next=0|0;var lod=this._LODValue+1;var tsx=0;var tsz=0;for(var l=0|0;l<this._LODLimits.length;l++){lod=this._LODValue+l+1;next=l>=this._LODLimits.length-1?0:this._LODLimits[l+1];nb=2*(this._LODLimits[l]-next);tsx+=this._averageSubSizeX*lod*nb;tsz+=this._averageSubSizeZ*lod*nb;remainder-=nb}tsx+=remainder*this._averageSubSizeX*this._LODValue;tsz+=remainder*this._averageSubSizeZ*this._LODValue;this._terrainSizeX=tsx;this._terrainSizeZ=tsz;this._terrainHalfSizeX=tsx*.5;this._terrainHalfSizeZ=tsz*.5;return this};DynamicTerrain.prototype.getHeightFromMap=function(x,z,options){return DynamicTerrain._GetHeightFromMap(x,z,this._mapData,this._mapSubX,this._mapSubZ,this._mapSizeX,this._mapSizeZ,options)};DynamicTerrain.GetHeightFromMap=function(x,z,mapData,mapSubX,mapSubZ,options){var mapSizeX=Math.abs(mapData[(mapSubX-1)*3]-mapData[0]);var mapSizeZ=Math.abs(mapData[(mapSubZ-1)*mapSubX*3+2]-mapData[2]);return DynamicTerrain._GetHeightFromMap(x,z,mapData,mapSubX,mapSubZ,mapSizeX,mapSizeZ,options)};DynamicTerrain._GetHeightFromMap=function(x,z,mapData,mapSubX,mapSubZ,mapSizeX,mapSizeZ,options){var x0=mapData[0];var z0=mapData[2];x=x-Math.floor((x-x0)/mapSizeX)*mapSizeX;z=z-Math.floor((z-z0)/mapSizeZ)*mapSizeZ;var col1=Math.floor((x-x0)*mapSubX/mapSizeX);var row1=Math.floor((z-z0)*mapSubZ/mapSizeZ);var col2=(col1+1)%mapSubX;var row2=(row1+1)%mapSubZ;var idx1=3*(row1*mapSubX+col1);var idx2=3*(row1*mapSubX+col2);var idx3=3*(row2*mapSubX+col1);var idx4=3*(row2*mapSubX+col2);DynamicTerrain._v1.copyFromFloats(mapData[idx1],mapData[idx1+1],mapData[idx1+2]);DynamicTerrain._v2.copyFromFloats(mapData[idx2],mapData[idx2+1],mapData[idx2+2]);DynamicTerrain._v3.copyFromFloats(mapData[idx3],mapData[idx3+1],mapData[idx3+2]);DynamicTerrain._v4.copyFromFloats(mapData[idx4],mapData[idx4+1],mapData[idx4+2]);var vA=DynamicTerrain._v1;var vB;var vC;var v;var xv4v1=DynamicTerrain._v4.x-DynamicTerrain._v1.x;var zv4v1=DynamicTerrain._v4.z-DynamicTerrain._v1.z;if(xv4v1==0||zv4v1==0){return DynamicTerrain._v1.y}var cd=zv4v1/xv4v1;var h=DynamicTerrain._v1.z-cd*DynamicTerrain._v1.x;if(z<cd*x+h){vB=DynamicTerrain._v4;vC=DynamicTerrain._v2;v=vA}else{vB=DynamicTerrain._v3;vC=DynamicTerrain._v4;v=vB}vB.subtractToRef(vA,DynamicTerrain._vAvB);vC.subtractToRef(vA,DynamicTerrain._vAvC);BABYLON.Vector3.CrossToRef(DynamicTerrain._vAvB,DynamicTerrain._vAvC,DynamicTerrain._norm);DynamicTerrain._norm.normalize();if(options&&options.normal){options.normal.copyFrom(DynamicTerrain._norm)}var d=-(DynamicTerrain._norm.x*v.x+DynamicTerrain._norm.y*v.y+DynamicTerrain._norm.z*v.z);var y=v.y;if(DynamicTerrain._norm.y!=0){y=-(DynamicTerrain._norm.x*x+DynamicTerrain._norm.z*z+d)/DynamicTerrain._norm.y}return y};DynamicTerrain.ComputeNormalsFromMapToRef=function(mapData,mapSubX,mapSubZ,normals){var mapIndices=[];var tmp1={normal:BABYLON.Vector3.Zero()};var tmp2={normal:BABYLON.Vector3.Zero()};var l=mapSubX*(mapSubZ-1);var i=0;for(i=0;i<l;i++){mapIndices.push(i+1,i+mapSubX,i);mapIndices.push(i+mapSubX,i+1,i+mapSubX+1)}BABYLON.VertexData.ComputeNormals(mapData,mapIndices,normals);var lastIdx=(mapSubX-1)*3;var colStart=0;var colEnd=0;for(i=0;i<mapSubZ;i++){colStart=i*mapSubX*3;colEnd=colStart+lastIdx;DynamicTerrain.GetHeightFromMap(mapData[colStart],mapData[colStart+2],mapData,mapSubX,mapSubZ,tmp1);DynamicTerrain.GetHeightFromMap(mapData[colEnd],mapData[colEnd+2],mapData,mapSubX,mapSubZ,tmp2);tmp1.normal.addInPlace(tmp2.normal).scaleInPlace(.5);normals[colStart]=tmp1.normal.x;normals[colStart+1]=tmp1.normal.y;normals[colStart+2]=tmp1.normal.z;normals[colEnd]=tmp1.normal.x;normals[colEnd+1]=tmp1.normal.y;normals[colEnd+2]=tmp1.normal.z}};DynamicTerrain.prototype.computeNormalsFromMap=function(){DynamicTerrain.ComputeNormalsFromMapToRef(this._mapData,this._mapSubX,this._mapSubZ,this._mapNormals);return this};DynamicTerrain.prototype.contains=function(x,z){if(x<this._positions[0]+this.mesh.position.x||x>this._positions[3*this._terrainIdx]+this.mesh.position.x){return false}if(z<this._positions[2]+this.mesh.position.z||z>this._positions[3*this._terrainIdx*this._terrainIdx+2]+this.mesh.position.z){return false}return true};DynamicTerrain.CreateMapFromHeightMap=function(heightmapURL,options,scene){var subX=options.subX||100;var subZ=options.subZ||100;var data=new Float32Array(subX*subZ*3);DynamicTerrain.CreateMapFromHeightMapToRef(heightmapURL,options,data,scene);return data};DynamicTerrain.CreateMapFromHeightMapToRef=function(heightmapURL,options,data,scene){var width=options.width||300;var height=options.height||300;var subX=options.subX||100;var subZ=options.subZ||100;var minHeight=options.minHeight||0;var maxHeight=options.maxHeight||10;var offsetX=options.offsetX||0;var offsetZ=options.offsetZ||0;var filter=options.colorFilter||new BABYLON.Color3(.3,.59,.11);var onReady=options.onReady;var onload=function(img){var canvas=document.createElement("canvas");var context=canvas.getContext("2d");var bufferWidth=img.width;var bufferHeight=img.height;canvas.width=bufferWidth;canvas.height=bufferHeight;context.drawImage(img,0,0);var buffer=context.getImageData(0,0,bufferWidth,bufferHeight).data;var x=0;var y=0;var z=0;for(var row=0;row<subZ;row++){for(var col=0;col<subX;col++){x=col*width/subX-width*.5;z=row*height/subZ-height*.5;var heightmapX=(x+width*.5)/width*(bufferWidth-1)|0;var heightmapY=bufferHeight-1-(z+height*.5)/height*(bufferHeight-1)|0;var pos=(heightmapX+heightmapY*bufferWidth)*4;var gradient=(buffer[pos]*filter.r+buffer[pos+1]*filter.g+buffer[pos+2]*filter.b)/255;y=minHeight+(maxHeight-minHeight)*gradient;var idx=(row*subX+col)*3;data[idx]=x+offsetX;data[idx+1]=y;data[idx+2]=z+offsetZ}}if(onReady){onReady(data,subX,subZ)}};BABYLON.Tools.LoadImage(heightmapURL,onload,function(){},scene.database)};DynamicTerrain.CreateUVMapToRef=function(subX,subZ,mapUVs){for(var h=0;h<subZ;h++){for(var w=0;w<subX;w++){mapUVs[(h*subX+w)*2]=w/subX;mapUVs[(h*subX+w)*2+1]=h/subZ}}};DynamicTerrain.CreateUVMap=function(subX,subZ){var mapUVs=new Float32Array(subX*subZ*2);DynamicTerrain.CreateUVMapToRef(subX,subZ,mapUVs);return mapUVs};DynamicTerrain.prototype.createUVMap=function(){this.mapUVs=DynamicTerrain.CreateUVMap(this._mapSubX,this._mapSubZ);return this};Object.defineProperty(DynamicTerrain.prototype,"refreshEveryFrame",{get:function(){return this._refreshEveryFrame},set:function(val){this._refreshEveryFrame=val},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"mesh",{get:function(){return this._terrain},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"camera",{get:function(){return this._terrainCamera},set:function(val){this._terrainCamera=val},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"subToleranceX",{get:function(){return this._subToleranceX},set:function(val){this._subToleranceX=val>0?val:1},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"subToleranceZ",{get:function(){return this._subToleranceZ},set:function(val){this._subToleranceZ=val>0?val:1},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"initialLOD",{get:function(){return this._initialLOD},set:function(val){this._initialLOD=val>0?val:1},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"LODValue",{get:function(){return this._LODValue},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"cameraLODCorrection",{get:function(){return this._cameraLODCorrection},set:function(val){this._cameraLODCorrection=val>=0?val:0},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"averageSubSizeX",{get:function(){return this._averageSubSizeX},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"averageSubSizeZ",{get:function(){return this._averageSubSizeZ},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"terrainSizeX",{get:function(){return this._terrainSizeX},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"terrainHalfSizeX",{get:function(){return this._terrainHalfSizeX},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"terrainSizeZ",{get:function(){return this._terrainSizeZ},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"terrainHalfSizeZ",{get:function(){return this._terrainHalfSizeZ},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"centerLocal",{get:function(){return this._centerLocal},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"centerWorld",{get:function(){return this._centerWorld},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"LODLimits",{get:function(){return this._LODLimits},set:function(ar){ar.sort(function(a,b){return b-a});this._LODLimits=ar},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"mapData",{get:function(){return this._mapData},set:function(val){this._mapData=val;this._datamap=true;this._mapSizeX=Math.abs(this._mapData[(this._mapSubX-1)*3]-this._mapData[0]);this._mapSizeZ=Math.abs(this._mapData[(this._mapSubZ-1)*this._mapSubX*3+2]-this._mapData[2]);this._averageSubSizeX=this._mapSizeX/this._mapSubX;this._averageSubSizeZ=this._mapSizeZ/this._mapSubZ;if(this._precomputeNormalsFromMap){this.computeNormalsFromMap()}this.update(true)},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"mapSubX",{get:function(){return this._mapSubX},set:function(val){this._mapSubX=val},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"mapSubZ",{get:function(){return this._mapSubZ},set:function(val){this._mapSubZ=val},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"mapColors",{get:function(){return this._mapColors},set:function(val){this._colormap=true;this._mapColors=val},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"mapUVs",{get:function(){return this._mapUVs},set:function(val){this._uvmap=true;this._mapUVs=val},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"mapNormals",{get:function(){return this._mapNormals},set:function(val){this._mapNormals=val},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"computeNormals",{get:function(){return this._computeNormals},set:function(val){this._computeNormals=val},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"useCustomVertexFunction",{get:function(){return this._useCustomVertexFunction},set:function(val){this._useCustomVertexFunction=val},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"isAlwaysVisible",{get:function(){return this._isAlwaysVisible},set:function(val){this.mesh.alwaysSelectAsActiveMesh=val;this._isAlwaysVisible=val},enumerable:true,configurable:true});Object.defineProperty(DynamicTerrain.prototype,"precomputeNormalsFromMap",{get:function(){return this._precomputeNormalsFromMap},set:function(val){this._precomputeNormalsFromMap=val},enumerable:true,configurable:true});DynamicTerrain.prototype.updateVertex=function(vertex,i,j){return};DynamicTerrain.prototype.updateCameraLOD=function(terrainCamera){var camLOD=0;return camLOD};DynamicTerrain.prototype.beforeUpdate=function(refreshEveryFrame){return};DynamicTerrain.prototype.afterUpdate=function(refreshEveryFrame){return};return DynamicTerrain}();DynamicTerrain._v1=BABYLON.Vector3.Zero();DynamicTerrain._v2=BABYLON.Vector3.Zero();DynamicTerrain._v3=BABYLON.Vector3.Zero();DynamicTerrain._v4=BABYLON.Vector3.Zero();DynamicTerrain._vAvB=BABYLON.Vector3.Zero();DynamicTerrain._vAvC=BABYLON.Vector3.Zero();DynamicTerrain._norm=BABYLON.Vector3.Zero();BABYLON.DynamicTerrain=DynamicTerrain})(BABYLON||(BABYLON={}));